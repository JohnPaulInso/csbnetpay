<!DOCTYPE html>
<html lang="en">
<head>
    <title>Historical Netpay</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.png" type="image/png" sizes="any">
</head>

<body>

<nav style="background-color: #003d6b; position: sticky; top: 0; z-index: 1000; padding: 0.5rem 1rem;">
    <div class="navbar-nav" style="color:#ddd;display: flex; justify-content: center;">
        <div style="color:#ddd;display: flex; align-items: center;">
            <a style="color:#aaa;" class="nav-item nav-link p-2" href="index.html"><b>NETPAY</b></a>
            <a style="color:#aaa;" class="nav-item nav-link p-2" href="index2.html"><b>DEDAMT</b></a>
            <a style="color:#aaa;" class="nav-item nav-link p-2" href="index3.html"><b>ONQ</b></a>
            <a style="color:#aaa;" class="nav-item nav-link p-2" href="index4.html"><b>PLI</b></a>
            <a class="nav-item nav-link p-2 text-white" href="index5.html"><b>LE</b></a>
        </div>
    </div>
</nav>













<!-- NETPAY Section --><div class="container mt-3">
    <h4 class="text-center pt-5 pb-3 mb-2">LOAN EVALUATION</h4>
    <div class="row">
        <div id="searchSectionNetpay" class="col-md-12">
            <div class="row pt-2">
                <div class="col-12 d-flex">
                    <input type="text" id="searchInputNetpay" class="form-control" placeholder="Employee Number..." style="flex-grow: 1;" oninput="syncInputs(this.value)">
                    <button id="searchButtonNetpay" class="btn btn-primary ml-2" onclick="triggerAllSearches()">Search</button>
                </div>
          
            </div>

            <a>4694264</p>
            

        </div>     
        

        <div id="loadingIndicatorNetpay" style="top:50% !important;display: none; text-align: center;">
            <img src="loading.gif" alt="Loading..." style="max-width: 100px;">
    
        </div>
    </div>

</div>











<div class="container ">
    <div class="row">
        <div class="col-md-12">
            <h3 id="employeeInfoNetpay" class="text-white"></h3>
        </div>
    </div>
    </div>
</div>





<!-- DEDAMT Section -->
<div id="searchSectionPos" class="container mt-5 d-none">
    <h1 class="text-center pt-5 pb-3 mb-2">DEDAMT POSITIVE</h1>
    <div class="row pt-2">
        <div class="col-12 d-flex">
            <input type="text" id="searchInputPos" class="form-control" placeholder="Employee Number..." style="flex-grow: 1;" oninput="syncInputs(this.value)">
            <button id="searchButtonPos" class="btn btn-primary ml-2" >Search</button>
        </div>
        <div id="loadingIndicatorPos" style="display: none; text-align: center;">
            <img src="loading.gif" alt="Loading..." style="max-width: 100px;">
        </div>
    </div>
</div>
<div class="container  d-none">
    <div class="row">
        <div class="col-md-12">
            <h3 id="employeeInfoPos" class="text-white"></h3>
        </div>
    </div>
    </div>
</div>

<!-- ONQUEUE Section -->
<div id="searchSectionOnq" class="container mt-5 d-none">
    <h1 class="text-center pt-5 pb-3 mb-2">ONQUEUE</h1>
    <div class="row pt-2">
        <div class="col-12 d-flex">
            <input type="text" id="searchInputOnq" class="form-control" placeholder="Employee Number..." style="flex-grow: 1;" oninput="syncInputs(this.value)">
            <button id="searchButtonOnq" class="btn btn-primary ml-2">Search</button>
        </div>
        <div id="loadingIndicatorOnq" style="display: none; text-align: center;">
            <img src="loading.gif" alt="Loading..." style="max-width: 100px;">
        </div>
    </div>
</div>
<br/>
<div class="container d-none ">
    <div class="row">
        <div class="col-md-12">
            <h3 id="employeeInfoOnq" class="text-white"></h3>
        </div>
    </div>
    </div>
</div>

<!-- PLI Section -->
<div id="searchSectionPLI" class="container mt-5 d-none">
    <h1 class="text-center pt-5 pb-3 mb-2">PLI DEDUCTION</h1>
    <div class="row pt-2">
        <div class="col-12 d-flex">
            <input type="text" id="searchInputPLI" class="form-control" placeholder="Employee Number..." style="flex-grow: 1;" oninput="syncInputs(this.value)">
            <button id="searchButtonPLI" class="btn btn-primary ml-2">Search</button>
        </div>
        <div id="loadingIndicatorPLI" style="display: none; text-align: center;">
            <img src="loading.gif" alt="Loading..." style="max-width: 100px;">
        </div>
    </div>
</div>
<br/>
<div class="container  d-none">
    <div class="row">
        <div class="col-md-12">
            <h3 id="employeeInfoPLI" class="text-white"></h3>
        </div>
    </div>
    </div>
</div>














<script>

    // Function to update the netpayCell
function updateNetPayCell() {
    var netPayValue = document.getElementById("netpaytable").innerHTML;
    document.getElementById("netpayCell").innerHTML = netPayValue;
}

// Create a MutationObserver to watch for changes
var observer = new MutationObserver(function(mutations) {
    updateNetPayCell(); // Call the update function whenever a mutation occurs
});

// Target the node to observe
var targetNode = document.getElementById("netpaytable");

// Observer options
var config = { childList: true, subtree: true };

// Start observing
if (targetNode) {
    observer.observe(targetNode, config);
}

// Initial update
updateNetPayCell();

</script>












<div style="margin-top: 10px;">
    
    <table style="width: 100%; border-collapse: collapse; text-align: left;">
        


        
        <tr>
            <td   class="smallfont"  style="border: 1px solid #ccc; padding: 10px;">LOAN AMT</td>
            <td style="border: 1px solid #ccc; padding: 10px;">
                <input type="text" class="form-control bg-dark text-light border-0 loanAmountInput" id="loanAmount" value="50,000" 
             onblur="formatLoanAmount()" />
            </td>
        </tr>
        
        <!-- Terms Row -->
        <tr>
            <td  class="smallfont"   style="border: 1px solid #ccc; padding: 10px;">TERM</td>
            <td style="border: 1px solid #ccc; padding: 10px;">
                <select id="terms" class="form-select bg-dark text-light border-0 termsSelect" 
                style="padding: 10px; width: 100%;" onchange="updateInterestRate()">
                    <script>
                        for (let i = 6; i <= 60; i++) {
                            document.write('<option value="' + i + '"' + (i === 60 ? ' selected' : '') + '>' + i + '</option>');
                        }
                    </script>
                </select>
            </td>
        </tr>

        <!-- Interest Rate Row (Read Only) -->
        <tr class="d-none">
            <td style="border: 1px solid #ccc; padding: 10px;">Interest Rate (%)</td>
            <td style="border: 1px solid #ccc; padding: 10px;">
                <input type="text" class="form-control bg-dark text-light" id="rate" value="9.66" 
                style="border: 1px solid #ccc; padding: 10px; width: 100%;" readonly />
            </td>
        </tr>









<!-- 
            <tr class="row results d-nones" >
                <td id="resultsPLI"></td>
                <td></td>
            </tr> -->


            <!-- <thead>
                <td id="a" class="smallfont" style="border: 1px solid #ccc; padding:  10px; background-color: #393939;">DESCRIPTION:</td>
                <td id="a" class="smallfont" style="border: 1px solid #ccc; padding:  10px; background-color: #393939;">AMOUNT</td>
            </thead> -->
        
        <tr>
            <td id="A1" class="smallfont" style="border: 1px solid #ccc; padding:  10px; background-color: #4d4d00;">NETPAY</td>
            <td id="resultsNetpay" style="border: 1px solid #ccc; padding:  10px; background-color: #4d4d00;"></td>
        </tr>



        
        <tr>
            <td id="A2" class="smallfont" style="border: 1px solid #ccc; padding:  10px; background-color: #4d4d00;">POS:</td>
            <td id="resultspos" style="border: 1px solid #ccc; padding:  10px; background-color: #4d4d00;"></td>
        </tr>


        <tr>
            <td id="A3"  class="smallfont" style="border: 1px solid #ccc; padding:  10px; background-color: green; color: white;">SUB TOTAL</td>
            <td id="netpaypositivetotalvalue" style="border: 1px solid #ccc; padding:  10px; background-color: green; color: white;"></td>
        </tr>
        
      
      


        
        


            <tbody>
                <tr class="mt-5">
                    <td id="A4" class="smallfont"  style="border: 1px solid #ccc; padding:  10px;">ABSNC/PVP</td>
                    <td style="padding-left:0px !important;border: 1px solid #ccc; padding:  10px;" id="resultsPLI1"></td>
                    <td class="d-none" style="padding-left:0px !important;border: 1px solid #ccc; padding:  10px;" id="resultsPLI0hidden"></td>
                </tr>
                <tr>
                    
                    <td  id="A5" class="smallfont"  style="border: 1px solid #ccc; padding:  10px;">PLI STPG</td>
                    <td style="padding-left:0px !important;border: 1px solid #ccc; padding:  10px;" id="resultsPLI2"></td>
                    <td class="d-none" style="padding-left:0px !important;border: 1px solid #ccc; padding:  10px;" id="resultsPLI1hidden"></td>
            
                </tr>
                <tr>
                    <td  id="A6" class="smallfont"  style="border: 1px solid #ccc; padding:  10px;">PLI 2</td>
                    <td style="padding-left:0px !important;border: 1px solid #ccc; padding:  10px;" id="resultsPLI3"></td>
                    <td class="d-none" style="padding-left:0px !important;border: 1px solid #ccc; padding:  10px;" id="resultsPLI2hidden"></td>
              
                </tr>
                <tr>
                    <td id="A7"  class="smallfont"  style="border: 1px solid #ccc; padding:  10px;">PLI 3</td>
                    <td style="padding-left:0px !important;border: 1px solid #ccc; padding:  10px;" id="resultsPLI4"></td>
                    <td class="d-none" style="padding-left:0px !important;border: 1px solid #ccc; padding:  10px;" id="resultsPLI3hidden"></td>
            
                </tr>
                <tr>
                    <td  id="A8" class="smallfont"  style="border: 1px solid #ccc; padding:  10px;">PLI 4</td>
                    <td style="padding-left:0px !important;border: 1px solid #ccc; padding:  10px;" id="resultsPLI5"></td>
                    <td class="d-none" style="padding-left:0px !important;border: 1px solid #ccc; padding:  10px;" id="resultsPLI4hidden"></td>
            
                
                
                
                </tr>

                




<tr>
    <td id="A10" class="smallfont" style="border: 1px solid #ccc; padding: 10px;">ANTICPT</td>
    <td style="border: 1px solid #ccc; padding: 10px; color: #5f5f5f;">
        <input id="anticipation" type="number" value="" class="form-control bg-dark text-light border-0">

    </td>
    <td class="d-none" id="anticipationhidden" style="border: 1px solid #ccc; padding: 10px; color: white;"></td>
</tr>
<tr>
    <td id="A11" class="smallfont" style="border: 1px solid #ccc; padding: 10px;">PRMTION</td>
    <td style="border: 1px solid #ccc; padding: 10px; color: #5f5f5f;">











            <!-- Table 1: Dropdown in First Column -->
            <div class="table-responsive" style="font-size:10px;">
                <table class="table table-dark table-sm">
                    <thead>
                        <tr style="font-size:8px;">
                            <th class="dropdown-col">SLRY GRD</th>
                            <th>BASIC</th>
                            <th>PRMTN NET</th>
                        </tr>
                    </thead>
                    <tbody id="table1Body">
                        <!-- First Row -->
                        <tr>
                            <td style="font-size:10px;">
                                <select id="salaryGradeDropdown1" class="form-select bg-dark text-white" onchange="updateSalaryRow(1)">
                                    <!-- Dropdown options will be populated dynamically -->
                                </select>
                            </td>
                            <td id="basicPayTable1"></td>
                            <td id="prmtnNetpayTable1"></td>
                        </tr>
                        <!-- Second Row -->
                        <tr>
                            <td style="font-size:10px;">
                                <select id="salaryGradeDropdown2" class="form-select bg-dark text-white" onchange="updateSalaryRow(2)">
                                    <!-- Dropdown options will be populated dynamically -->
                                </select>
                            </td>
                            <td id="basicPayTable2"></td>
                            <td id="prmtnNetpayTable2"></td>
                        </tr>
                        <tr>
                            <td>DIFF</td>
                            <td id="basicPayTable3" ></td>
                            <td>
                               
                                <input 
                                id="promotion" 
                                type="number" 
                                class="bg-dark text-light border-0" 
                                style="font-size:10px; font-weight: bold; width:50%;"  
                                step="0.01" 
                                oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\..*/g, '$1').replace(/(\.\d{2})\d*/, '$1')" 
                                pattern="^\d+(\.\d{0,2})?$" 
                                min="0" 
                                placeholder="0.00"
                            />
                            
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>







    </td>




    <td class="d-none" value="" id="promotionhidden" style="border: 1px solid #ccc; padding: 10px; color: white;">


        

        
    </td>




    
</tr>


                    <tr>
                        <td id="A12"  class="smallfont"  style="border: 1px solid #ccc; padding:  10px; background-color: #200000; color: white;">SUB TOTAL:</td>
                        <td id="plitotalvalue" style="border: 1px solid #ccc; padding:  10px;padding-left:  10px !important; background-color: #200000; color: white;">₱0.00</td>
                        <td class="d-none"  id="plitotalvaluehidden" style="border: 1px solid #ccc; padding:  10px; background-color: #200000; color: white;">₱0.00</td>
                    </tr>
                
                
<tr>
    <td id="A13"  class="smallfont"  style="border: 1px solid #ccc; padding:  10px; background-color: #001f14; color: white;">TOTAL</td>
    <td id="netpaypPliTotal" style="border: 1px solid #ccc; padding:  10px;padding-left:  10px !important; background-color: #001f14; color: white;"></td>
    <!-- <td class="d-none"  id="plitotalvaluehidden" style="border: 1px solid #ccc; padding:  10px; background-color: #001f14; color: white;">₱0.00</td> -->
</tr>




            </tbody>
        












            

            

        <script>
            
// Function to update hidden cells with the current total amounts
function updateHiddenCells() {
    let totalPLI = 0; // Initialize total for PLI calculation

    // Loop through each index from 0 to 4 to access totalAmount and hidden cells
    for (let i = 0; i <= 4; i++) {
        const totalAmountCell = document.querySelector(`#totalAmountPLI${i}`);
        const hiddenCell = document.querySelector(`#resultsPLI${i}hidden`);

        if (totalAmountCell && hiddenCell) {
            const totalAmountText = totalAmountCell.innerText.trim();
            const totalAmountValue = parseFloat(totalAmountText.replace(/₱|,/g, '').trim());

            if (!isNaN(totalAmountValue)) {
                hiddenCell.textContent = totalAmountValue.toFixed(2);
                totalPLI += totalAmountValue; // Add to totalPLI
            } else {
                hiddenCell.textContent = '';
            }
        }
    }

    // Handle anticipation and promotion cells
    const anticipationCell = document.querySelector(`#anticipation`);
    const anticipationHiddenCell = document.querySelector(`#anticipationhidden`);
    const promotionCell1 = document.querySelector(`#promotion`);
    const promotionHiddenCell = document.querySelector(`#promotionhidden`);

    // Update anticipation hidden cell and add to totalPLI
    if (anticipationCell && anticipationHiddenCell) {
        const anticipationValue = parseFloat(anticipationCell.value.trim()); // Get the value from the input

        if (!isNaN(anticipationValue)) {
            anticipationHiddenCell.textContent = anticipationValue.toFixed(2);
            totalPLI += anticipationValue; // Add to totalPLI
        } else {
            anticipationHiddenCell.textContent = '';
        }
    }

    // Update promotion hidden cell and add to totalPLI
    if (promotionCell1 && promotionHiddenCell) {
        const promotionValue1 = parseFloat(promotionCell1.value.trim()); // Get the value from the input

        if (!isNaN(promotionValue1)) {
            promotionHiddenCell.textContent = promotionValue1.toFixed(2);
            totalPLI += promotionValue1; // Add to totalPLI
        } else {
            promotionHiddenCell.textContent = '';
        }
    }

    // Update the PLI total hidden cell
    const plitotalValueHiddenCell = document.querySelector(`#plitotalvalue`);
    if (plitotalValueHiddenCell) {
        plitotalValueHiddenCell.textContent = '₱' + totalPLI.toFixed(2); // Display the total in the hidden cell
    }
}


// Set an interval to continuously update the hidden cells every 2 seconds (2000 ms)
setInterval(updateHiddenCells, 10);

// Initial call to set values immediately
updateHiddenCells();


















                // JavaScript to handle the calculation
                document.addEventListener('DOMContentLoaded', function() {
    const plitotalvalueInput = document.getElementById('plitotalvalue');
    const resultsonqs = document.getElementsById('resultsonqhidden');
    const semiTotalValueInput = document.getElementById('semiTotalValue');

    const netpaypPliTotal = document.getElementById('netpaypPliTotal');

    function updateSemiTotalValue() {
        const plitotalvalue = parseFloat(plitotalvalueInput.value) || 0;

        // Extract the numeric value from the totalAmount cell
        const resultsonqValue = parseFloat(resultsonqs.innerText.replace(/[₱,]/g, '').trim()) || 0;
        

        
        const semiTotalValue = netpaypPliTotal - resultsonqValue;

        semiTotalValueInput.value = semiTotalValue.toFixed(2); // Format to 2 decimal places
    }

    // Add input event listeners
    plitotalvalueInput.addEventListener('input', updateSemiTotalValue);
    // Call updateSemiTotalValue when the page loads to set initial value
    updateSemiTotalValue();
});



function updateOnQueueValue() {
    // Helper function to get the numeric value
    function getNumericValue(ids) {
        let value = 0;
        
        // Loop through the array of IDs and check for the first available element
        for (let id of ids) {
            const element = document.getElementById(id);
            if (element) {
                // Parse the numeric value while removing currency symbols and commas
                value = parseFloat(element.textContent.replace(/[₱, ]/g, '').trim());
                return isNaN(value) ? 0 : value; // Return the valid numeric value
            }
        }
        
        console.error(`None of the elements with IDs "${ids.join(', ')}" were found.`);
        return 0; // Return 0 if neither element exists
    }

    function copyOnQueueToResult() {
        const onQueueValue = getNumericValue(["onqueuespan", "totalAmount"]);

        // Set the value in the element with id "resultsonqhidden"
        document.getElementById("resultsonqhidden").textContent = `₱${onQueueValue.toFixed(2)}`;
    }

    // Call the function immediately to set the initial value
    copyOnQueueToResult();

    // Update the value every 1000 milliseconds (1 second)
    setInterval(() => {
        copyOnQueueToResult();
        calculateAll(); // Ensure calculateAll() is called as well
    }, 1000);
}

// Call the update function when the page loads
window.onload = updateOnQueueValue;


        </script>
        










        <tr>
            <td id="A13"  class="smallfont"  style="border: 1px solid #ccc; padding:  10px; background-color: #4d4d00;">LESS ONQ:</td>
            <!-- <td class="resultsonq d-none" style="visibility:hidden;border: 1px solid #ccc; padding:  10px; background-color: #4d4d00;"></td> -->
     
     
                <td  id="resultsonq"  style="padding-left:0px !important;border: 1px solid #ccc; padding: -5px; background-color: #4d4d00;"> </td>
                <td class="d-none"  id="resultsonqhidden" style="border: 1px solid #ccc; padding:  10px; background-color: #4d4d00; color: white;"></td>

        </tr>


        
        <tr>
            <td id="A14"  class="smallfont"  style="border: 1px solid #ccc; padding:  10px; background-color: green; color: white;">SEMI TOTAL:</td>
            <td id="semiTotalValue" style=" border: 1px solid #ccc; padding:  10px; background-color: green; color: white;">₱0.00</td>
</tr>
        <tr>
            <td id="A15"  class="smallfont"  style="border: 1px solid #ccc; padding:  10px;">NEW CSBDED</td>
            <td id="monthlyPaymentCell" style=" border: 1px solid #ccc; padding:  10px;"></td>
            <!-- MONTHLY PAYMENT FROM CALCULATOR RESULT  -->
        </tr>
        <tr>
            <td id="A16" class="smallfont" style="border: 1px solid #ccc; padding:  10px; background-color: green; color: white;">NEW NETPAY:</td>
            <td  id="finalTotalValue" style=" border: 1px solid #ccc; padding:  10px; background-color: green; color: white;"></td>
            <!-- semiTotalValue minus monthlyPaymentCell -->

        </tr>

        
    </table>




<div class="d-flex justify-content-center mt-5">
    <button class="btn btn-success btn-lg fs-5" onclick="calculateAll()">COMPUTE</button>
</div>

<script>





function calculateAll() {
    // Helper function to get the numeric value
    function getNumericValue(id) {
        const element = document.getElementById(id);
        if (element) {
            // Parse the numeric value while removing currency symbols and commas
            const value = parseFloat(element.textContent.replace(/[₱, ]/g, '').trim());
            return isNaN(value) ? 0 : value; // Return 0 if value is NaN
        } else {
            console.error(`Element with ID "${id}" not found.`);
            return 0; // Return 0 if the element does not exist
        }
    }

    calculatePayment()

    // Get numeric values from table cells
    const resultsNetpay = getNumericValue("resultsNetpay");
    const resultspos = getNumericValue("resultspos");
    const pliTotalValue = getNumericValue("plitotalvalue");
    const resultsonq = getNumericValue("resultsonq");
    const monthlyPaymentCell = getNumericValue("monthlyPaymentCell");

    
    const netpaypPliTotal = getNumericValue("netpaypPliTotal");
    


    const resultsonqhidden = getNumericValue("resultsonqhidden");
    


    // Get additional values from table cells
    const resultsPLI1 = getNumericValue("totalAmountPLI0");
    const resultsPLI2 = getNumericValue("totalAmountPLI1");
    const resultsPLI3 = getNumericValue("totalAmountPLI2");
    const resultsPLI4 = getNumericValue("totalAmountPLI3");
    const resultsPLI5 = getNumericValue("totalAmountPLI4");
    const anticipation = getNumericValue("anticipation");
    const promotion = getNumericValue("promotion");

    // Calculate total additions
    const totalAdditions = resultsPLI1 + resultsPLI2 + resultsPLI3 + resultsPLI4 + resultsPLI5;

    // Debugging: Log values for verification
    console.log(`Netpay: ₱${resultsNetpay}, POS: ₱${resultspos}, Additions: ₱${totalAdditions}`);

    // First calculation: Adding resultsNetpay + resultspos + totalAdditions
    const netpayPositiveTotal = resultsNetpay + resultspos;
    document.getElementById("netpaypositivetotalvalue").textContent = `₱${netpayPositiveTotal.toFixed(2)}`;

    // Second calculation: PLI Total - On Queue
const resultsonqValue = resultsonq || 0; // Default to 0 if resultsonq is empty or undefined
const semiTotalValue = netpaypPliTotal  - resultsonqhidden;
document.getElementById("semiTotalValue").textContent = `₱${semiTotalValue.toFixed(2)}`;

    // Second calculation: PLI Total - On Queue
    document.getElementById("semiTotalValue").textContent = `₱${semiTotalValue.toFixed(2)}`;


    // Final calculation: Semi Total - Monthly Payment
    const finalTotalValue = semiTotalValue - monthlyPaymentCell;
    document.getElementById("finalTotalValue").textContent = `₱${finalTotalValue.toFixed(2)}`;

    // Debugging: Log finalTotalValue for verification
    console.log(`Final Total Value: ₱${finalTotalValue}`);

    // Now calculate the final addition of netPayPositiveTotal and pliTotalValue
    const netPayValue = getNumericValue("netpaypositivetotalvalue");
    const total = netPayValue + pliTotalValue;

    // Format the result as PHP currency (2 decimal places)
    const formattedTotal = total.toLocaleString('en-PH', { style: 'currency', currency: 'PHP' });

    // Display the result in the element with id="netpaypPliTotal"
    document.getElementById("netpaypPliTotal").textContent = formattedTotal;
}





// Add event listener to the button
document.getElementById("calculateButton").addEventListener("click", function() {
    for (let i = 0; i < 3; i++) {
        calculateAll(); // Call the function three times
    }
});




</script>









<table class="mt-5" style="width: 100%; border-collapse: collapse; text-align: left;">
    
    <h4 class="text-center mt-5 pt-5 mb-2">LOAN PROCEEDS</h4>
    <!-- Loan Proceeds -->
    <tr>
        <td id="A1" class="smallfont" style="border: 1px solid #ccc; padding: 10px;">LOAN PRCDS</td>
        <td style="border: 1px solid #ccc; padding: 10px;" id="loanProceeds"></td>
    </tr>
    
    <!-- Redemption 1 -->
    <tr>
        <td id="A2" class="smallfont" style="border: 1px solid #ccc; padding: 10px;">RDMTN 1</td>
        <td style="border: 1px solid #ccc; padding: 10px;">
            <input id="redemption1" type="number" value="" class="form-control bg-dark text-light border-0">
        </td>
    </tr>

    <!-- Redemption 2 -->
    <tr>
        <td id="A3" class="smallfont" style="border: 1px solid #ccc; padding: 10px;">RDMTN 2</td>
        <td style="border: 1px solid #ccc; padding: 10px;">
            <input id="redemption2" type="number" value="" class="form-control bg-dark text-light border-0">
        </td>
    </tr>

    <!-- Redemption 3 -->
    <tr>
        <td id="A4" class="smallfont" style="border: 1px solid #ccc; padding: 10px;">RDMTN 3</td>
        <td style="border: 1px solid #ccc; padding: 10px;">
            <input id="redemption3" type="number" value="" class="form-control bg-dark text-light border-0">
        </td>
    </tr>

    <!-- Old Balance -->
    <tr>
        <td id="A5" class="smallfont" style="border: 1px solid #ccc; padding: 10px;">OLD BLNCE</td>
        <td style="border: 1px solid #ccc; padding: 10px;">
            <input id="oldBalance" type="number" value="" class="form-control bg-dark text-light border-0">
        </td>
    </tr>

    <!-- Top Up -->
    <tr>
        <td id="A6" class="smallfont" style="border: 1px solid #ccc; padding: 10px;">TOP UP</td>
        <td style="border: 1px solid #ccc; padding: 10px;">
            <input id="topUp" type="number" value="" class="form-control bg-dark text-light border-0">
        </td>
    </tr>








    
    <!-- DAB -->
    <tr>
        <td id="A7" class="smallfont" style="border: 1px solid #ccc; padding: 10px;">DAB</td>
        <td style="border: 1px solid #ccc; padding: 10px; position: relative;">
            <span id="dab">0.00</span>
            <input type="checkbox" class="dab-checkbox" checked style="position: absolute; right: 10px; transform: scale(1.3); -webkit-transform: scale(1.3);" />
        </td>
    </tr>
    
    <!-- ADVANCE PAYMENT -->
    <tr>
        <td id="A8" class="smallfont" style="border: 1px solid #ccc; padding: 10px;">ADVANCE PAYMENT</td>
        <td style="border: 1px solid #ccc; padding: 10px; position: relative;"  id="advancepaymentCell">
            <span id="advancepayment">0.00</span>


            <select id="multiplierAdvance" class="bg-dark text-light" style="position: absolute; right: 35px;font-size: 12px;" ></select>
        
            <script>
                const select = document.getElementById('multiplierAdvance');
                for (let i = 1; i <= 8; i++) {
                    select.innerHTML += `<option value="${i}">${i}</option>`;
                }
            </script>




            <input type="checkbox" class="advancepayment-checkbox" checked style="position: absolute; right: 10px; transform: scale(1.3); -webkit-transform: scale(1.3);" />
        </td>
    </tr>

    <!-- Proceeds -->
    <tr>
        <td id="A9" class="smallfont" style="border: 1px solid #ccc; padding: 10px;">PROCEEDS</td>
        <td style="border: 1px solid #ccc; padding: 10px;" id="proceeds"></td>
        
    </tr>
</table>








<script>
    // Helper function to format numbers with thousands separators and two decimal places
    function formatNumber(number) {
        return number.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    // Helper function to parse currency formatted values (like ₱10,540.07) into numbers
    function parseCurrency(value) {
        return parseFloat(value.replace(/[₱,]/g, '')) || 0;
    }

    let originalDab = 0;
    let currentMultiplier = 1; // Track current multiplier
    let intervalId; // Store the interval ID for managing the setInterval

    // Function to calculate values including advance payment
    function calculateValues() {
        const loanAmount = parseFloat(document.getElementById("loanAmount").value.replace(/,/g, '')) || 0;
        const redemption1 = parseFloat(document.getElementById("redemption1").value) || 0;
        const redemption2 = parseFloat(document.getElementById("redemption2").value) || 0;
        const redemption3 = parseFloat(document.getElementById("redemption3").value) || 0;
        const oldBalance = parseFloat(document.getElementById("oldBalance").value) || 0;
        const topUp = parseFloat(document.getElementById("topUp").value) || 0;

        // Loan Proceeds formula
        const loanProceeds = loanAmount - (loanAmount * 0.06);
        document.getElementById("loanProceeds").innerText = formatNumber(loanProceeds);

        // DAB formula
        const dabCheckbox = document.querySelector(".dab-checkbox");
        let dab = 0; // Default to 0 if checkbox is unchecked
        if (dabCheckbox.checked) {
            dab = loanAmount * 0.015;
            originalDab = dab; // Save original value
        }
        document.getElementById("dab").innerText = formatNumber(dab);

        // Retrieve advancepayment from the DOM or use the computed one
        const advancepayment = parseFloat(document.getElementById("advancepayment").innerText.replace(/,/g, '')) || 0;

        // Proceeds formula, now includes conditional DAB value
        const proceeds = loanProceeds - redemption1 - redemption2 - redemption3 - oldBalance + topUp + dab - advancepayment;
        document.getElementById("proceeds").innerText = formatNumber(proceeds);

        // Get the values from the monthly payment and sum amount elements
        const monthlyPaymentElement = document.getElementById("monthlyPaymentCell");
        const sumAmountElement = document.querySelector(".sum-amount");

        // Ensure the elements exist
        if (!monthlyPaymentElement || !sumAmountElement) {
            console.log("Required elements not found!");
            return;
        }

        const monthlyPayment = parseCurrency(monthlyPaymentElement.innerText);
        const sumAmount = parseCurrency(sumAmountElement.innerText);

        // Calculate advance payment based on current multiplier
        const advancePayment = (monthlyPayment - sumAmount) * currentMultiplier;
        document.getElementById("advancepayment").innerText = formatNumber(advancePayment); // Update displayed advance payment
    }

    // Function to update values based on checkboxes
    function updateValuesOnCheckbox() {
        const dabCheckbox = document.querySelector(".dab-checkbox");
        const advancePaymentCheckbox = document.querySelector(".advancepayment-checkbox");
        const multiplierAdvance = document.getElementById('multiplierAdvance');

        // If the DAB checkbox is unchecked, set DAB to 0, else restore original value
        if (!dabCheckbox.checked) {
            document.getElementById("dab").innerText = formatNumber(0);
        } else {
            document.getElementById("dab").innerText = formatNumber(originalDab);
        }

        // If the Advance Payment checkbox is unchecked
        if (!advancePaymentCheckbox.checked) {
            document.getElementById("advancepayment").innerText = formatNumber(0);
            multiplierAdvance.style.display = 'none'; // Hide the dropdown
        } else {
            multiplierAdvance.style.display = 'block'; // Show the dropdown
            // Recalculate the advance payment with current multiplier
            calculateValues(); // Ensure it uses the updated numbers for advance payment
        }

        // Check if any checkbox is checked
        if (dabCheckbox.checked || advancePaymentCheckbox.checked) {
            startInterval(); // Restart the interval if at least one is checked
        } else {
            clearInterval(intervalId); // Clear the interval if both are unchecked
        }
    }

    // Function to handle multiplier selection
    function handleMultiplierChange() {
        const multiplierAdvance = document.getElementById('multiplierAdvance');
        currentMultiplier = parseInt(multiplierAdvance.value, 10);

        // Update advance payment based on the selected multiplier
        calculateValues(); // This will ensure the recalculation uses the latest multiplier
    }

    // Start the interval for calculations
    function startInterval() {
        if (!intervalId) { // Only set the interval if it's not already set
            intervalId = setInterval(() => {
                const dabCheckbox = document.querySelector(".dab-checkbox");
                const advancePaymentCheckbox = document.querySelector(".advancepayment-checkbox");

                // Only calculate if at least one checkbox is checked
                if (dabCheckbox.checked || advancePaymentCheckbox.checked) {
                    calculateValues();
                    updateValuesOnCheckbox(); // Update display based on checkbox state
                }
            }, 300);
        }
    }

    // Initialize calculation at page load
    calculateValues();
    startInterval(); // Start the interval for the first time

    // Event listeners for checkboxes
    document.querySelector(".dab-checkbox").addEventListener("change", updateValuesOnCheckbox);
    document.querySelector(".advancepayment-checkbox").addEventListener("change", updateValuesOnCheckbox);

    // Event listener for the dropdown
    document.getElementById('multiplierAdvance').addEventListener('change', handleMultiplierChange);
</script>








    
    <div class="container pt-5 pb-5 mt-5 mb-5"></div>
</div>



<script>
    document.getElementById('searchButton').addEventListener('click', function() {
        // Simulate showing the tables (in reality, this should come from your search logic)
        document.getElementById('netpaytable').style.display = 'block';
        document.getElementById('positivetable').style.display = 'block';
        document.getElementById('totalAmount').style.display = 'block';
    
        // Call the function to update values after a short delay to allow the DOM to update
        setTimeout(updateValues, 100); // Adjust delay if needed
    });
    
    function updateValues() {
        // Get values from the referenced tables
        const netpayCell = document.querySelector('#netpaytable td');
        const posCell = document.querySelector('#positivetable td');
        // const resultsonq = document.querySelector('#totalAmount td');
    
        // Only update if the cells have values
        if (netpayCell && netpayCell.innerText) {
            document.getElementById('netpayCell').innerText = netpayCell.innerText;
        }
        if (posCell && posCell.innerText) {
            document.getElementById('posCell').innerText = posCell.innerText;
        }
        if (resultsonq && resultsonq.innerText) {
            document.getElementById('resultsonq').innerText = resultsonq.innerText;
        }
    }
    </script>
    

















    <script>
        // Load and parse CSV when the page is loaded
        window.onload = function () {
            loadprmtnCSV();
        };
        
        // Function to load and parse CSV file
        function loadprmtnCSV() {
            fetch("promotion_bracket.csv")
                .then(response => response.text())
                .then(data => {
                    const parsedData = parseCSV(data);
                    populateSalaryDropdown(parsedData);
                })
                .catch(error => console.error("Error loading CSV:", error));
        }
        
        // Function to parse CSV data into an array of objects
        function parseCSV(data) {
            const rows = data.split('\n').map(row => row.split(','));
            const jsonData = rows.slice(1).map(row => {
                return {
                    salaryGrade: row[0] ? row[0].trim() : '',
                    basicPay: row[1] ? row[1].trim() : '',
                    prmtnNetpay: row[11] ? row[11].trim() : '' // Ensure this index matches the correct column for PRMTN NET
                };
            });
            return jsonData;
        }
        
        // Function to populate both dropdowns with unique salary grade steps
        function populateSalaryDropdown(data) {
            const dropdown1 = document.getElementById("salaryGradeDropdown1");
            const dropdown2 = document.getElementById("salaryGradeDropdown2");
            const uniqueSalaryGradeStep = new Set();
        
            data.forEach(row => {
                const salaryGradeStep = row.salaryGrade;
        
                if (!uniqueSalaryGradeStep.has(salaryGradeStep)) {
                    uniqueSalaryGradeStep.add(salaryGradeStep);
                    
                    const option1 = new Option(salaryGradeStep, salaryGradeStep);
                    dropdown1.add(option1);
                    
                    const option2 = new Option(salaryGradeStep, salaryGradeStep);
                    dropdown2.add(option2);
                }
            });
        }
        
        // Global variables to store selected values for comparison
        let firstRowBasicPay = 0;
        let secondRowBasicPay = 0;
        let firstRowprmtnNetpay = 0;
        let secondRowprmtnNetpay = 0;
        
        // Helper function to clean and parse the numeric values from the table
        function parseValue(value) {
            return parseFloat(value.replace(/,/g, '') || 0);
        }
        
        // Update only the specific row's data based on dropdown selection
        function updateSalaryRow(rowNumber) {
            const selectedSalaryGrade = document.getElementById(`salaryGradeDropdown${rowNumber}`).value;
        
            fetch("promotion_bracket.csv")
                .then(response => response.text())
                .then(data => {
                    const parsedData = parseCSV(data);
        
                    // Log the selected salary grade for debugging
                    console.log("Selected Salary Grade for Row " + rowNumber + ": " + selectedSalaryGrade);
                    
                    const filteredData = parsedData.find(row => {
                        return row.salaryGrade === selectedSalaryGrade;
                    });
        
                    if (filteredData) {
                        const basicPay = parseValue(filteredData.basicPay);
                        const prmtnNetpay = parseValue(filteredData.prmtnNetpay);
        
                        // Log values for debugging
                        console.log(`Row ${rowNumber} Basic Pay: ${basicPay}, Promotion Net Pay: ${prmtnNetpay}`);
        
                        document.getElementById(`basicPayTable${rowNumber}`).textContent = basicPay.toLocaleString();
                        document.getElementById(`prmtnNetpayTable${rowNumber}`).textContent = prmtnNetpay.toLocaleString();
        
                        // Update global variables for salary differences
                        if (rowNumber === 1) {
                            firstRowBasicPay = basicPay;
                            firstRowprmtnNetpay = prmtnNetpay;
                        } else if (rowNumber === 2) {
                            secondRowBasicPay = basicPay;
                            secondRowprmtnNetpay = prmtnNetpay;
                        }
        
                        // Calculate and display the difference
                        calculateSalaryDifference();
                    } else {
                        console.warn(`No data found for the selected salary grade: ${selectedSalaryGrade}`);
                    }
                })
                .catch(error => console.error("Error updating salary row:", error));
        }
        
        // Function to calculate the differences
        function calculateSalaryDifference() {
            if (firstRowBasicPay !== 0 && secondRowBasicPay !== 0) {
                const basicPayDifference = secondRowBasicPay - firstRowBasicPay;
                document.getElementById("basicPayTable3").textContent = basicPayDifference.toLocaleString();
            }
        
            if (firstRowprmtnNetpay !== 0 && secondRowprmtnNetpay !== 0) {
                const prmtnNetpayDifference = secondRowprmtnNetpay - firstRowprmtnNetpay;
                // Set the value formatted to 2 decimal points
                document.getElementById("promotion").value = prmtnNetpayDifference.toFixed(2);
            }
        }
        </script>
        












    
























    







<SCRIPT>




    
document.addEventListener('DOMContentLoaded', () => {
        const prompt = document.getElementById('fullscreenPrompt');

        // Show the prompt when the mouse moves
        document.addEventListener('mousemove', () => {
            prompt.style.display = 'block';
        });

        // Enter fullscreen when the prompt is clicked
        prompt.addEventListener('click', () => {
            openFullscreen();
            prompt.style.display = 'none'; // Hide prompt after entering full-screen
        });
    });

    function openFullscreen() {
        const elem = document.documentElement;
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        } else if (elem.mozRequestFullScreen) {
            elem.mozRequestFullScreen();
        } else if (elem.webkitRequestFullscreen) {
            elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen();
        }
    }



    
        const csvFilesNetpay = [
            'sep24.csv'
        ];
        
    document.getElementById('searchButtonNetpay').addEventListener('click', searchEmployeeNetpay);

    function searchEmployeeNetpay() {
    const searchInputNetpay = document.getElementById('searchInputNetpay').value.trim();
    const loadingIndicatorNetpay = document.getElementById('loadingIndicatorNetpay');

    if (!searchInputNetpay) {
        alert('Please enter an employee number.');
        return;
    }

    const Netpay = document.getElementById('resultsNetpay');
    const employeeInfoSectionNetpay = document.getElementById('employeeInfoNetpay');
    Netpay.innerHTML = ''; // Clear previous results
    employeeInfoSectionNetpay.innerHTML = ''; // Clear previous employee info
    loadingIndicatorNetpay.style.display = 'block'; // Show loading indicator

    // Automatically limit to the last 12 months (latest first)
    const last12MonthsFilesNetpay = csvFilesNetpay.slice(0, 12);

    let fetchedDataNet = [];
    let latestCsvDataNetpay = null;

    Promise.all(last12MonthsFilesNetpay.map(csvFile => fetchCSVNetpay(csvFile)))
        .then(allData => {
            fetchedDataNet = allData;
            fetchedDataNet.sort((a, b) => b.date - a.date);
            latestCsvDataNetpay = fetchedDataNet[0].csvData;
            displayEmployeeInfoNetpay(fetchedDataNet[0].monthName, latestCsvDataNetpay);
            displayResultsTableNetpay(fetchedDataNet);
        })
        .catch(error => {
            console.error('Error fetching CSV data:', error);
        })
        .finally(() => {
            loadingIndicatorNetpay.style.display = 'none'; // Hide loading indicator
        });
}


    function fetchCSVNetpay(csvFile) {
        return new Promise((resolve, reject) => {
            const monthName = getMonthNameFromCsvNetpay(csvFile);
            const date = getDateFromCsvNetpay(csvFile);

            fetch(csvFile)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Unable to fetch ${csvFile}`);
                    }
                    return response.text();
                })
                .then(text => {
                    const csvData = parseCSVNetpay(text);
                    resolve({ monthName, csvData, date });
                })
                .catch(error => {
                    console.error(`Error fetching data for ${monthName}:`, error);
                    reject(error);
                });
        });
    }

    function getDateFromCsvNetpay(csvFile) {
        const monthMap = {
            'jan': 0, 'feb': 1, 'mar': 2, 'apr': 3, 'may': 4, 'jun': 5,
            'jul': 6, 'aug': 7, 'sep': 8, 'oct': 9, 'nov': 10, 'dec': 11
        };
        const monthPart = csvFile.slice(0, 3);
        const yearPart = '20' + csvFile.slice(3, 5);
        const monthIndex = monthMap[monthPart];
        return new Date(yearPart, monthIndex);
    }

    function getMonthNameFromCsvNetpay(csvFile) {
        const monthMap = {
            'jan': 'January', 'feb': 'February', 'mar': 'March', 'apr': 'April', 'may': 'May', 'jun': 'June',
            'jul': 'July', 'aug': 'August', 'sep': 'September', 'oct': 'October', 'nov': 'November', 'dec': 'December'
        };
        const monthPart = csvFile.slice(0, 3);
        const yearPart = '20' + csvFile.slice(3, 5);
        return `${monthMap[monthPart]} ${yearPart}`;
    }

    function parseCSVNetpay(data) {
        const rows = data.trim().split('\n');
        return rows.map(row => row.split(','));
    }

    function displayEmployeeInfoNetpay(monthName, csvData) {
        const employeeInfoSectionNetpay = document.getElementById('employeeInfoNetpay');
        let employeeFound = false;

        for (let i = 1; i < csvData.length; i++) {
            const row = csvData[i];
            if (row.length < 4) continue;
            const empno = row[3];
            if (empno === document.getElementById('searchInputNetpay').value.trim()) {
                employeeFound = true;

                const div = row[1];
                const sta = row[2];
                const fname = row[4];
                const mi = row[5];
                const lname = row[6];
                const account = row[8];

                employeeInfoSectionNetpay.innerHTML = `
                <div class="pt-4 mt-3 pl-3 pr-3">
                  <strong>NAME:</strong><b style="color:orange"> ${fname} ${mi} ${lname}</b><br/>
                    <strong>EMPNO:</strong><b style="color:orange">   ${empno} </b><br/>
                    <strong>DIV / STA:</strong><b style="color:orange"> ${div} / ${sta}</b><br/>
                  </div>
                `;
                break;
            }
        }

        if (!employeeFound) {
            employeeInfoSectionNetpay.innerHTML = 'No Netpay found in the latest data.';
        }
    }






    function displayResultsTableNetpay(fetchedDataNet) {
    const resultsSectionNetpay = document.getElementById('resultsNetpay');
    
    // Clear previous results
    resultsSectionNetpay.innerHTML = '';

    let totalNetPay = 0; // Variable to hold the total net pay

    // Iterate over the fetched data and add rows to the results section
    fetchedDataNet.forEach(data => {
        data.csvData.forEach((row, index) => {
            if (index === 0) return; // Skip header row
            if (row.length < 4) return; // Skip malformed rows

            const empno = row[3];
            if (empno === document.getElementById('searchInputNetpay').value.trim()) {
                const monthName = data.monthName;
                const takehome = parseFloat(row[7]);
                totalNetPay += takehome; // Accumulate total net pay

                const formattedTakehome = takehome.toLocaleString('en-PH', { style: 'currency', currency: 'PHP' });

                const rowElement = document.createElement('tr');
                rowElement.innerHTML = `
    <!-- <tr>${monthName} NETPAY</tr> -->
                    <tr id="netpaytable"><b>${formattedTakehome}</b></tr>
                `;
                resultsSectionNetpay.appendChild(rowElement); // Append directly to the results section
            }
        });
    });

    if (totalNetPay > 0) {
        // Only calculate total if there's net pay to display
        calculateAndDisplayTotal(totalNetPay);
    }
}

function calculateAndDisplayTotal(totalNetPay) {
    // Get the positivetable value (assuming it's already populated elsewhere)
    const positiveValue = document.getElementById('positivetable').textContent.replace(/[^\d.-]/g, '') || 0;

    // Calculate total
    const total = parseFloat(totalNetPay) + parseFloat(positiveValue);

    // Display the total in netpaypositivetotalvalue element
    document.getElementById('netpaypositivetotalvalue').textContent = total.toLocaleString('en-PH', { style: 'currency', currency: 'PHP' });
}



    











































const csvFilesPos = [
    'pos_sep24.csv'
];

document.getElementById('searchButtonPos').addEventListener('click', searchEmployeePos);

function searchEmployeePos() {
    const searchInputPos = document.getElementById('searchInputPos').value.trim();
    const loadingIndicatorPos = document.getElementById('loadingIndicatorPos');

    if (!searchInputPos) {
        alert('Please enter an employee number.');
        return;
    }

    const resultsSectionPos = document.getElementById('resultspos');
    const employeeInfoSectionPos = document.getElementById('employeeInfoPos');
    resultsSectionPos.innerHTML = ''; // Clear previous results
    employeeInfoSectionPos.innerHTML = ''; // Clear previous employee info
    loadingIndicatorPos.style.display = 'block'; // Show loading indicator

    // Automatically limit to the last 12 months (latest first)
    const last12MonthsFilesPos = csvFilesPos.slice(0, 12);

    let fetchedDataPos = [];

    Promise.all(last12MonthsFilesPos.map(csvFile => fetchCSVPos(csvFile)))
        .then(allData => {
            fetchedDataPos = allData.filter(data => data !== null); // Filter out failed fetches
            if (fetchedDataPos.length === 0) {
                alert('No valid data found in the provided files.');
                return;
            }
            fetchedDataPos.sort((a, b) => b.date - a.date);
            displayEmployeeInfoPos(fetchedDataPos[0].monthName, fetchedDataPos[0].csvData);
            displayResultsTablePos(fetchedDataPos);
        })
        .catch(error => {
            console.error('Error fetching CSV data:', error);
            alert('Error fetching data. Check the console for more details.');
        })
        .finally(() => {
            loadingIndicatorPos.style.display = 'none'; // Hide loading indicator
        });
}

function fetchCSVPos(csvFile) {
    return new Promise((resolve, reject) => {
        const monthName = getMonthNameFromCsvPos(csvFile);
        const date = getDateFromCsvPos(csvFile);

        console.log(`Fetching data from file: ${csvFile}`);

        fetch(csvFile)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Unable to fetch ${csvFile}. Status: ${response.status}`);
                }
                return response.text();
            })
            .then(text => {
                console.log(`Successfully fetched data from ${csvFile}`);
                const csvData = parseCSVPos(text);
                resolve({ monthName, csvData, date });
            })
            .catch(error => {
                console.error(`Error fetching data for ${monthName}:`, error);
                resolve(null); // Return null for failed fetches, don't reject to allow Promise.all to proceed
            });
    });
}

function getDateFromCsvPos(csvFile) {
    const fileName = csvFile.replace('pos_', ''); // Remove 'pos_' prefix
    const monthMap = {
        'jan': 0, 'feb': 1, 'mar': 2, 'apr': 3, 'may': 4, 'jun': 5,
        'jul': 6, 'aug': 7, 'sep': 8, 'oct': 9, 'nov': 10, 'dec': 11
    };
    const monthPart = fileName.slice(0, 3);
    const yearPart = '20' + fileName.slice(3, 5);
    const monthIndex = monthMap[monthPart];
    return new Date(yearPart, monthIndex);
}

function getMonthNameFromCsvPos(csvFile) {
    const fileName = csvFile.replace('pos_', ''); // Remove 'pos_' prefix
    const monthMap = {
        'jan': 'January', 'feb': 'February', 'mar': 'March', 'apr': 'April', 'may': 'May', 'jun': 'June',
        'jul': 'July', 'aug': 'August', 'sep': 'September', 'oct': 'October', 'nov': 'November', 'dec': 'December'
    };
    const monthPart = fileName.slice(0, 3);
    const yearPart = '20' + fileName.slice(3, 5);
    return `${monthMap[monthPart]} ${yearPart}`;
}

function parseCSVPos(data) {
    const rows = data.trim().split('\n');
    return rows.map(row => row.split(','));
}

function displayEmployeeInfoPos(monthName, csvData) {
    const employeeInfoSectionPos = document.getElementById('employeeInfoPos');
    let employeeFound = false;

    for (let i = 1; i < csvData.length; i++) {
        const row = csvData[i];
        if (row.length < 4) continue;
        const empno = row[3];
        if (empno === document.getElementById('searchInputPos').value.trim()) {
            employeeFound = true;

            const div = row[1];
            const sta = row[2];
            const fname = row[4];
            const mi = row[5];
            const lname = row[6];

            employeeInfoSectionPos.innerHTML = `
                `;
            break;
        }
    }

    if (!employeeFound) {
        employeeInfoSectionPos.innerHTML = 'No Positive Dedamt found in the latest data.';
    }
}














function displayResultsTablePos(fetchedDataPos) {
    const resultsSectionPos = document.getElementById('resultspos');
    
    // Clear previous results
    resultsSectionPos.innerHTML = '';

    const resultsMap = new Map(); // To store sums and details for dropdown

    fetchedDataPos.forEach(data => {
    data.csvData.forEach((row, index) => {
        if (index === 0) return; // Skip header row
        if (row.length < 4) return; // Skip malformed rows

        const empno = row[3];
        if (empno === document.getElementById('searchInputPos').value.trim()) {
            const monthName = data.monthName;
            const termyy = parseFloat(row[12]);
            const termm = parseFloat(row[11]); 
            const dedamt = parseFloat(row[13]);
            
            // Accumulate amounts
            if (!resultsMap.has(monthName)) {
                resultsMap.set(monthName, { sum: 0, details: [] });
            }
            const entry = resultsMap.get(monthName);
entry.sum += dedamt;
entry.details.push(dedamt.toLocaleString('en-PH', { style: 'currency', currency: 'PHP' }));

// Push the year and month as formatted date string
entry.details.push(termyy.toString());  // Ensure it's treated as a string
entry.details.push(termm.toString().padStart(2, '0'));  // Ensure it's treated as a two-digit string

        }
    });
});



// Add aggregated results directly to the results section
const resultsTable = document.getElementById('resultsTable'); // Assume there's a table with this ID
resultsMap.forEach((value, monthName) => {
    const totalDedAmt = value.sum.toLocaleString('en-PH', { style: 'currency', currency: 'PHP' });
    
    const rowElement = document.createElement('tr');
    rowElement.innerHTML = `
        <td>
            <div class="position-relative">
                <u><b class="sum-amount" style="cursor: pointer">${totalDedAmt}</b></u>
                <div class="dropdown-menu p-1 pl-3" style="display: none; position: absolute; z-index: 1; width: 210px;"> 
                
                    <div style="display: flex; justify-content: space-between;"> <!-- Use flexbox for alignment -->
                        ${value.details.join(' / ')} <!-- Join details with a slash or space -->
                    </div>
                </div>
            </div>
        </td>
    `;
    
        // Add hover event listeners
        const sumAmount = rowElement.querySelector('.sum-amount');
        const dropdownMenu = rowElement.querySelector('.dropdown-menu');

        sumAmount.addEventListener('mouseenter', () => {
            dropdownMenu.style.display = 'block';
        });

        sumAmount.addEventListener('mouseleave', () => {
            dropdownMenu.style.display = 'none';
        });

        resultsSectionPos.appendChild(rowElement); // Append directly to the results section
    });
}



























































    const csvFilesOnq = [
        'onq_sep24.csv'
    ];

    document.getElementById('searchButtonOnq').addEventListener('click', searchEmployeeOnq);
   function searchEmployeeOnq() {
    const searchInputOnq = document.getElementById('searchInputOnq').value.trim();
    const loadingIndicatorOnq = document.getElementById('loadingIndicatorOnq');

    if (!searchInputOnq) {
        alert('Please enter an employee number.');
        return;
    }

    const resultsSectionOnq = document.getElementById('resultsonq');
    const employeeInfoSectionOnq = document.getElementById('employeeInfoOnq');
    resultsSectionOnq.innerHTML = ''; // Clear previous results
    employeeInfoSectionOnq.innerHTML = ''; // Clear previous employee info
    loadingIndicatorOnq.style.display = 'block'; // Show loading indicator

    const last12MonthsFilesOnq = csvFilesOnq.slice(0, 12);
    let fetchedDataOnq = [];

    Promise.all(last12MonthsFilesOnq.map(csvFile => fetchCSVOnq(csvFile)))
        .then(allData => {
            fetchedDataOnq = allData.filter(data => data !== null);
            if (fetchedDataOnq.length === 0) {
                alert('No valid data found in the provided files.');
                return;
            }
            fetchedDataOnq.sort((a, b) => b.date - a.date);
            displayEmployeeInfoOnq(fetchedDataOnq[0].monthName, fetchedDataOnq[0].csvData);
            displayResultsTableOnq(fetchedDataOnq);

            // Call the function to update the resultsonq after results are displayed
            updateresultsonq();

            // Automatically press the Calculate button and update the monthly payment
            calculateAndUpdateMonthlyPayment();
        })
        .catch(error => {
            console.error('Error fetching CSV data:', error);
            alert('Error fetching data. Check the console for more details.');
        })
        .finally(() => {
            loadingIndicatorOnq.style.display = 'none'; // Hide loading indicator
        });
}

function calculateAndUpdateMonthlyPayment() {
    // Simulate clicking the Calculate button




    
    calculatePayment();

    // Retrieve the value from the monthlyPayment span
    const monthlyPaymentValue = document.getElementById('monthlyPayment').textContent;

    // Update the monthlyPaymentCell with the retrieved value
    const monthlyPaymentCell = document.getElementById('monthlyPaymentCell');
    monthlyPaymentCell.textContent = monthlyPaymentValue; // Update the cell with the payment value

    // Get the semiTotalValue and calculate the new net pay
    const semiTotalValue = parseFloat(document.getElementById('semiTotalValue').textContent.replace(/₱/g, '').replace(/,/g, ''));

    // Extract the numeric value from the monthly payment and format it for calculation
    const monthlyPaymentNumeric = parseFloat(monthlyPaymentValue.replace(/₱/g, '').replace(/,/g, ''));

    // Calculate NEW NETPAY
    const newNetPay = semiTotalValue - monthlyPaymentNumeric;

    // Update the finalTotalValue with the new net pay
    document.getElementById('finalTotalValue').textContent = `₱${newNetPay.toFixed(2)}`;
}



function updateresultsonq() {
    const totalAmountCell = document.getElementsById('totalAmount');
    const totalAmountText = totalAmountCell.textContent || "";
    const totalAmountNumber = parseFloat(totalAmountText.replace(/[₱,]/g, '').trim());

    const resultsonq = document.getElementsById('resultsonq');
    resultsonq.textContent = `₱${totalAmountNumber.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;

    calculateSemiTotal();
}


function calculateSemiTotal() {
    // Fetch and parse the PLI total value
    const pliTotalCell = document.getElementById('plitotalvalue');
    const pliTotalText = pliTotalCell.textContent || "";
    const pliTotalValue = parseFloat(pliTotalText.replace(/[₱,]/g, '').trim());


    // Fetch and parse the onqueue value
    const resultsonq = document.getElementsByClassName('resultsonqhidden');
    const onqueueText = resultsonq.length > 0 ? resultsonq[0].textContent : "";  // Assuming you're getting the first element
    const onqueueValue = parseFloat(onqueueText.replace(/[₱,]/g, '').trim());
    
    const netpaypPliTotal = document.getElementsByClassName('netpaypPliTotal');
    const netpaypPliTotalText = resultsonq.length > 0 ? resultsonq[0].textContent : "";  // Assuming you're getting the first element
    const netpaypPliTotalValue = parseFloat(onqueueText.replace(/[₱,]/g, '').trim());

    // Calculate the semi total
    const semiTotalValue = netpaypPliTotal - onqueueValue;

    // Update the semi total cell with the formatted value
    const semiTotalCell = document.getElementById('semitotalvalue'); // Ensure you use the correct ID
    if (!isNaN(semiTotalValue)) {
        semiTotalCell.textContent = `₱${semiTotalValue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
    } else {
        semiTotalCell.textContent = "Error in calculation";
    }
}









    function fetchCSVOnq(csvFile) {
        return new Promise((resolve, reject) => {
            const monthName = getMonthNameFromCsvOnq(csvFile);
            const date = getDateFromCsvOnq(csvFile);

            fetch(csvFile)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Unable to fetch ${csvFile}. Status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(text => {
                    const csvData = parseCSVOnq(text);
                    resolve({ monthName, csvData, date });
                })
                .catch(error => {
                    console.error(`Error fetching data for ${monthName}:`, error);
                    resolve(null);
                });
        });
    }

    function getDateFromCsvOnq(csvFile) {
        const fileName = csvFile.replace('onq_', '');
        const monthMap = {
            'jan': 0, 'feb': 1, 'mar': 2, 'apr': 3, 'may': 4, 'jun': 5,
            'jul': 6, 'aug': 7, 'sep': 8, 'oct': 9, 'nov': 10, 'dec': 11
        };
        const monthPart = fileName.slice(0, 3);
        const yearPart = '20' + fileName.slice(3, 5);
        const monthIndex = monthMap[monthPart];
        return new Date(yearPart, monthIndex);
    }

    function getMonthNameFromCsvOnq(csvFile) {
        const fileName = csvFile.replace('onq_', '');
        const monthMap = {
            'jan': 'January', 'feb': 'February', 'mar': 'March', 'apr': 'April', 'may': 'May', 'jun': 'June',
            'jul': 'July', 'aug': 'August', 'sep': 'September', 'oct': 'October', 'nov': 'November', 'dec': 'December'
        };
        const monthPart = fileName.slice(0, 3);
        const yearPart = '20' + fileName.slice(3, 5);
        return `${monthMap[monthPart]} ${yearPart}`;
    }

    function parseCSVOnq(data) {
        const rows = data.trim().split('\n');
        return rows.map(row => row.split(','));
    }

    function displayEmployeeInfoOnq(monthName, csvData) {
        const employeeInfoSectionOnq = document.getElementById('employeeInfoOnq');
        let employeeFound = false;

        for (let i = 1; i < csvData.length; i++) {
            const row = csvData[i];
            if (row.length < 4) continue;
            const empno = row[3];
            if (empno === document.getElementById('searchInputOnq').value.trim()) {
                employeeFound = true;

                const div = row[1];
                const sta = row[2];
                const fname = row[4];
                const mi = row[5];
                const lname = row[6];

                employeeInfoSectionOnq.innerHTML = `
                  `;
                break;
            }
        }

        if (!employeeFound) {
            employeeInfoSectionOnq.innerHTML = 'No On-queue found in the latest data.';
        }

    }



    
    function displayResultsTableOnq(fetchedDataOnq) {
    const resultsSectionOnq = document.getElementById('resultsonq');

    const table = document.createElement('table');
    table.classList.add('table', 'table-borderless', 'border-0', 'text-white');

    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = `
       <!-- <th class="font-weight-bold">ONQUEUE MONTH</th>
        <th class="font-weight-bold">DEDAMT</th> -->
    `;
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement('tbody');
    const resultsMap = new Map();

    fetchedDataOnq.forEach(data => {
        data.csvData.forEach((row, index) => {
            if (index === 0) return;

            const empno = row[3];
            if (empno === document.getElementById('searchInputOnq').value.trim()) {
                const monthName = data.monthName;
                const dedamt = parseFloat(row[13]);

                if (!resultsMap.has(monthName)) {
                    resultsMap.set(monthName, { sum: 0, details: [] });
                }

                const dedcode = row[7];
                const effyy = row[9];
                const effmm = convertMonth(row[10]); // Convert month number
                const termyy = row[11];
                const termmm = convertMonth(row[12]); // Convert month number
                const policyno = row[15];

                const entry = resultsMap.get(monthName);
                entry.sum += dedamt;
                entry.details.push({ dedcode, policyno, effyy, effmm, termyy, termmm, dedamt });
            }
        });
    });

    resultsMap.forEach((data, monthName) => {
        const row = document.createElement('tr');
        row.innerHTML = `
        <!--     <td>${monthName}</td> 
            <td id="totalAmount">
                ₱${data.sum.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}
                <button id="viewmore" class="btn btn-link" style="color: white; padding-left: 10px;" onclick="toggleDetails(this)">View More</button>
           -->


     <td id="totalAmount" style="border: 0;border:none;margin-bottom:0px" class="d-flex justify-content-between align-items-center">
    <span id="onqueuespan">
                ₱${data.sum.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}
                </span>
    <button class="view-more-btn border-0 bg-transparent p-0"  onclick="toggleDetails(this)">📖</button>
</td>
           
                </td>
        `;
        tbody.appendChild(row);
        
        const detailRow = document.createElement('tr');
        detailRow.classList.add('details-row', 'hidden'); // Initially hidden
        const detailCell = document.createElement('td');
        detailCell.setAttribute('colspan', 2);
        detailCell.innerHTML = `
            <table class="table table-sm text-white" style="font-size:9px">
                <thead>
                    <tr>
                        <th>/</th>
                        <th>PLI</th>
                        <th>EFF</th>
                        <th>TERM</th>
                        <th>DEDAMT</th>
                        <th>PLCYNO</th>
                    </tr>
                </thead>
                <tbody>
                    ${data.details.map(d => `
                        <tr>
                            <td><input type="checkbox" class="dedamt-checkbox" data-dedamt="${d.dedamt}" checked /></td>
                            <td>${d.dedcode.toString().padStart(5, '0')}</td>
                            <td>${d.effmm.toString().padStart(2, '0')}/${d.effyy}</td>
                            <td>${d.termmm.toString().padStart(2, '0')}/${d.termyy}</td>
                            <td><b>₱${d.dedamt.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</b></td>
                            <td>${d.policyno}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
        
        detailRow.appendChild(detailCell);
        tbody.appendChild(detailRow);
    });

    table.appendChild(tbody);
    resultsSectionOnq.appendChild(table);
}

function toggleDetails(button) {
    const detailsRow = button.closest('tr').nextElementSibling; // Find the next row (details)
    detailsRow.classList.toggle('hidden'); // Toggle visibility
}



function updateresultsonq() {
    // Get the total amount from the totalAmount cell
    const totalAmountCell = document.getElementById('totalAmount');
    const totalAmountText = totalAmountCell.textContent || ""; // Fallback in case of no content
    const totalAmountNumber = parseFloat(totalAmountText.replace(/[₱,]/g, '').trim()); // Remove currency and commas

    // Update the resultsonq with the total amount
    const resultsonq = document.getElementsByClassName('resultsonq');
    resultsonq.textContent = `₱${totalAmountNumber.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
}

// Call this function whenever the total amount is updated
// Example usage after you set the total amount somewhere in your code
// updateresultsonq();








// Initial CSS to hide details rows
const style = document.createElement('style');
style.textContent = `
    .hidden {
        display: none;
    }
`;
document.head.appendChild(style);




function convertMonth(monthNumber) {
    const monthNames = ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"];
    return monthNames[parseInt(monthNumber, 10) - 1];
}
function calculateTotal() {
    const checkboxes = document.querySelectorAll('.dedamt-checkbox');
    let total = 0;

    checkboxes.forEach(checkbox => {
        if (checkbox.checked) {
            total += parseFloat(checkbox.dataset.dedamt);
        }
    });

    const totalDisplay = document.querySelector('#totalAmount');
    totalDisplay.innerText = `₱${total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;

    // Create or update the View More button
    let viewMoreButton = document.querySelector('#viewmore');
    if (!viewMoreButton) {
        // Create the button if it doesn't exist
        viewMoreButton = document.createElement('button');
        viewMoreButton.setAttribute('id', 'viewmore');
        viewMoreButton.classList.add('btn', 'btn-link', 'border-0', 'bg-transparent', 'p-0');
        viewMoreButton.style.color = 'white';
        viewMoreButton.style.paddingLeft = '10px';
        viewMoreButton.innerText = '📖';

        
        viewMoreButton.onclick = function () { toggleDetails(this); };

        // Append the button to the totalDisplay element
        totalDisplay.appendChild(viewMoreButton);
    }
}


// Event listener for checkbox changes
document.addEventListener('change', (event) => {
    if (event.target.classList.contains('dedamt-checkbox')) {
        calculateTotal();
    }
});

// Initial calculation on page load
document.addEventListener('DOMContentLoaded', calculateTotal);










    




    























































    document.addEventListener('DOMContentLoaded', () => {
        const prompt = document.getElementById('fullscreenPrompt');

        // Show the prompt when the mouse moves
        document.addEventListener('mousemove', () => {
            prompt.style.display = 'block';
        });

        // Enter fullscreen when the prompt is clicked
        prompt.addEventListener('click', () => {
            openFullscreen();
            prompt.style.display = 'none'; // Hide prompt after entering full-screen
        });
    });

    function openFullscreen() {
        const elem = document.documentElement;
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        } else if (elem.mozRequestFullScreen) {
            elem.mozRequestFullScreen();
        } else if (elem.webkitRequestFullscreen) {
            elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen();
        }
    }




const csvFilesPLI = [
    'pli_sep24.csv'
];

document.getElementById('searchButtonPLI').addEventListener('click', searchEmployeePLI);









function searchEmployeePLI() {
    const searchInputPLI = document.getElementById('searchInputPLI').value.trim();
    const loadingIndicatorPLI = document.getElementById('loadingIndicatorPLI');

    if (!searchInputPLI) {
        alert('Please enter an employee number.');
        return;
    }

    const resultsSectionPLI1 = document.getElementById('resultsPLI1');
    const resultsSectionPLI2 = document.getElementById('resultsPLI2');
    const resultsSectionPLI3 = document.getElementById('resultsPLI3');
    const resultsSectionPLI4 = document.getElementById('resultsPLI4');
    const resultsSectionPLI5 = document.getElementById('resultsPLI5');
    
    
    const employeeInfoSectionPLI = document.getElementById('employeeInfoPLI');


    resultsSectionPLI1.innerHTML = ''; // Clear previous results





    employeeInfoSectionPLI.innerHTML = ''; // Clear previous employee info
    loadingIndicatorPLI.style.display = 'block'; // Show loading indicator

    const last12MonthsFilesPLI = csvFilesPLI.slice(0, 12);

    let fetchedDataPLI = [];

    Promise.all(last12MonthsFilesPLI.map(csvFile => fetchCSVPLI(csvFile)))
        .then(allData => {
            fetchedDataPLI = allData.filter(data => data !== null);
            if (fetchedDataPLI.length === 0) {
                alert('No valid data found in the provided files.');
                return;
            }
            fetchedDataPLI.sort((a, b) => b.date - a.date);
            displayEmployeeInfoPLI(fetchedDataPLI[0].monthName, fetchedDataPLI[0].csvData);
            displayResultsTablePLI(fetchedDataPLI);
        })
        .catch(error => {
            console.error('Error fetching CSV data:', error);
            alert('Error fetching data. Check the console for more details.');
        })
        .finally(() => {
            loadingIndicatorPLI.style.display = 'none'; // Hide loading indicator
        });
}

function fetchCSVPLI(csvFile) {
    return new Promise((resolve, reject) => {
        const monthName = getMonthNameFromCsvPLI(csvFile);
        const date = getDateFromCsvPLI(csvFile);

        fetch(csvFile)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Unable to fetch ${csvFile}. Status: ${response.status}`);
                }
                return response.text();
            })
            .then(text => {
                const csvData = parseCSVPLI(text);
                resolve({ monthName, csvData, date });
            })
            .catch(error => {
                console.error(`Error fetching data for ${monthName}:`, error);
                resolve(null);
            });
    });
}

function getDateFromCsvPLI(csvFile) {
    const fileName = csvFile.replace('pli_', '');
    const monthMap = {
        'jan': 0, 'feb': 1, 'mar': 2, 'apr': 3, 'may': 4, 'jun': 5,
        'jul': 6, 'aug': 7, 'sep': 8, 'oct': 9, 'nov': 10, 'dec': 11
    };
    const monthPart = fileName.slice(0, 3);
    const yearPart = '20' + fileName.slice(3, 5);
    const monthIndex = monthMap[monthPart];
    return new Date(yearPart, monthIndex);
}

function getMonthNameFromCsvPLI(csvFile) {
    const fileName = csvFile.replace('pli_', '');
    const monthMap = {
        'jan': 'January', 'feb': 'February', 'mar': 'March', 'apr': 'April', 'may': 'May', 'jun': 'June',
        'jul': 'July', 'aug': 'August', 'sep': 'September', 'oct': 'October', 'nov': 'November', 'dec': 'December'
    };
    const monthPart = fileName.slice(0, 3);
    const yearPart = '20' + fileName.slice(3, 5);
    return `${monthMap[monthPart]} ${yearPart}`;
}

function parseCSVPLI(data) {
    const rows = data.trim().split('\n');
    return rows.map(row => row.split(','));
}

function displayEmployeeInfoPLI(monthName, csvData) {
    const employeeInfoSectionPLI = document.getElementById('employeeInfoPLI');
    let employeeFound = false;

    for (let i = 1; i < csvData.length; i++) {
        const row = csvData[i];
        if (row.length < 4) continue;
        const empno = row[3];
        if (empno === document.getElementById('searchInputPLI').value.trim()) {
            employeeFound = true;

            const div = row[1];
            const sta = row[2];
            const fname = row[5];
            const mi = row[6];
            const lname = row[7];

            employeeInfoSectionPLI.innerHTML = `

            `;
            break;
        }
    }

    if (!employeeFound) {
        employeeInfoSectionPLI.innerHTML = 'No PLI found in the latest data.';
    }
}




















function displayResultsTablePLI(fetchedDataPLI) {
    const resultsSections = [
        document.getElementById('resultsPLI1'),
        document.getElementById('resultsPLI2'),
        document.getElementById('resultsPLI3'),
        document.getElementById('resultsPLI4'),
        document.getElementById('resultsPLI5'),
    ];

    resultsSections.forEach((resultsSection, index) => {
        // Create a new table for each results section
        const table = createResultsTable(fetchedDataPLI, index);
        resultsSection.appendChild(table);
    });
}

function createResultsTable(fetchedDataPLI, tableIndex) {
    const table = document.createElement('table');
    table.classList.add('table', 'table-borderless', 'border-0', 'text-white');

    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = `<!-- <th class="font-weight-bold">PLI MONTH</th>
        <th class="font-weight-bold">Total Amount</th> -->`;
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement('tbody');
    const resultsMap = new Map();

    fetchedDataPLI.forEach(data => {
        data.csvData.forEach((row, index) => {
            if (index === 0) return;

            const empno = row[3];
            if (empno === document.getElementById('searchInputPLI').value.trim()) {
                const monthName = data.monthName;
                const dedamtpli = parseFloat(row[15]);

                if (!resultsMap.has(monthName)) {
                    resultsMap.set(monthName, { sum: 0, details: [] });
                }

                const dedcode = row[9];
                const effyy = row[11];
                const effmm = convertMonth(row[12]);
                const termyy = row[13];
                const termmm = convertMonth(row[14]);
                const policyno = row[16];

                const entry = resultsMap.get(monthName);
                entry.sum += dedamtpli;
                entry.details.push({ dedcode, policyno, effyy, effmm, termyy, termmm, dedamtpli });
            }
        });
    });

    resultsMap.forEach((data, monthName) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <!-- <td>${monthName}</td> -->
               <!-- ₱${data.sum.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} -->
     <td id="totalAmountPLI${tableIndex}" style="border: 0;border:none;margin-bottom:0px" class="d-flex justify-content-between align-items-center">
    <span id="">₱0.00</span>
    <button class="view-more-btn border-0 bg-transparent p-0">📖</button>
</td>

        `;
        tbody.appendChild(row);

        const detailRow = document.createElement('tr');
        const detailCell = document.createElement('td');
        detailCell.setAttribute('colspan', 2);
        detailCell.innerHTML = `
            <table class="table table-sm text-white" style="font-size:9px">
                <thead>
                    <tr>
                        <th>/</th>
                        <th>PLI</th>
                        <th>EFF</th>
                        <th>TERM</th>
                        <th>DEDPLI</th>
                        <th>PLCYNO</th>
                    </tr>
                </thead>
                <tbody>
                    ${data.details.map(d => `
                        <tr>
                            <td><input type="checkbox" class="dedamtpli-checkbox" data-dedamtpli="${d.dedamtpli}" /></td>
                            <td>${d.dedcode.toString().padStart(5, '0')}</td>
                            <td>${d.effmm.toString().padStart(2, '0')}/${d.effyy}</td>
                            <td>${d.termmm.toString().padStart(2, '0')}/${d.termyy}</td>
                            <td><b>₱${d.dedamtpli.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</b></td>
                            <td>${d.policyno}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;

        detailRow.style.display = 'none';

        row.querySelector('.view-more-btn').addEventListener('click', () => {
            const isVisible = detailRow.style.display === 'table-row';
            detailRow.style.display = isVisible ? 'none' : 'table-row';
        });

        detailRow.appendChild(detailCell);
        tbody.appendChild(detailRow);
    });

    table.appendChild(tbody);
    
    // Handle checkbox logic
    const handleCheckboxClick = (event) => {
        // Deselect all other checkboxes in this specific table
        let totalAmount = 0;

        // Loop through all checkboxes in this table's context
        table.querySelectorAll('.dedamtpli-checkbox').forEach(checkbox => {
            if (checkbox === event.target) {
                // If the current checkbox is checked, add to total
                if (checkbox.checked) {
                    totalAmount = parseFloat(checkbox.getAttribute('data-dedamtpli'));
                }
            } else {
                // Uncheck all other checkboxes
                checkbox.checked = false;
            }
        });

        // Update the total amount displayed in the table
        const totalAmountPLICell = document.querySelector(`#totalAmountPLI${tableIndex}`);
        totalAmountPLICell.innerHTML = `₱${totalAmount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;

        // Clear previous "View More" button if exists
        const existingButton = totalAmountPLICell.querySelector('.view-more-btn');
        if (existingButton) {
            existingButton.remove();
        }

        // Create and append new "View More" button
        const viewMoreButton = document.createElement('button');
        viewMoreButton.textContent = "📖";
        viewMoreButton.classList.add('view-more-btn', 'bg-transparent', 'border-0', 'p-0');
        viewMoreButton.style.marginLeft = '10px';

        viewMoreButton.addEventListener('click', (event) => {
            const detailRow = event.target.closest('tr').nextElementSibling;
            const isVisible = detailRow.style.display === 'table-row';
            detailRow.style.display = isVisible ? 'none' : 'table-row';
        });

        totalAmountPLICell.appendChild(viewMoreButton);
    };

    // Add event listeners to checkboxes for this table
    table.querySelectorAll('.dedamtpli-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', handleCheckboxClick);
    });

    return table;
}










































function checkFinalTotalValue() {
    const finalTotalElement = document.getElementById('finalTotalValue');
    const value = parseFloat(finalTotalElement.textContent.replace(/[^0-9.-]+/g,"")); // Remove any non-numeric characters

    if (value < 5000) {
        finalTotalElement.style.color = 'red';
    } else {
        finalTotalElement.style.color = ''; // Reset to default if not below 5000
    }
}

// Call the function whenever needed (e.g., after value update)
checkFinalTotalValue();



</SCRIPT>







































<script>
    function syncInputs(value) {
        document.getElementById('searchInputPos').value = value;
        document.getElementById('searchInputOnq').value = value;
        document.getElementById('searchInputPLI').value = value;
        document.getElementById('searchInputLCS').value = value;
    }

    function checkLoadingComplete(loadingIndicatorId) {
        return new Promise(resolve => {
            const loadingIndicator = document.getElementById(loadingIndicatorId);
            const checkLoading = setInterval(() => {
                if (loadingIndicator.style.display === 'none') {
                    clearInterval(checkLoading);
                    resolve();
                }
            }, 100); // Adjust the interval as needed
        });
    }

    async function triggerSearch(buttonId, loadingIndicatorId) {
        const button = document.getElementById(buttonId);
        button.disabled = true; // Disable the button to prevent multiple clicks
        button.click(); // Simulate the button click

        // Wait for the loading to complete
        await checkLoadingComplete(loadingIndicatorId);
        button.disabled = false; // Re-enable the button
    }

    function triggerAllButtonsOnce() {
        // Trigger all the buttons
        // document.getElementById('searchButtonNetpay').click();
        document.getElementById('searchButtonPos').click();
        document.getElementById('searchButtonOnq').click();
        document.getElementById('searchButtonPLI').click();
        document.getElementById('searchButtonLCS').click();

        // Disable all buttons after the first click to prevent future clicks
        document.getElementById('searchButtonNetpay').disabled = true;
        document.getElementById('searchButtonPos').disabled = true;
        document.getElementById('searchButtonOnq').disabled = true;
        document.getElementById('searchButtonPLI').disabled = true;
        document.getElementById('searchButtonLCS').disabled = true;
    }

    // Add event listeners to all buttons
    document.getElementById('searchButtonNetpay').addEventListener('click', triggerAllButtonsOnce);
    document.getElementById('searchButtonPos').addEventListener('click', triggerAllButtonsOnce);
    document.getElementById('searchButtonOnq').addEventListener('click', triggerAllButtonsOnce);
    document.getElementById('searchButtonPLI').addEventListener('click', triggerAllButtonsOnce);
    document.getElementById('searchButtonLCS').addEventListener('click', triggerAllButtonsOnce);


</script>









<div class="offset-md-1 d-none mb-5 pb-5"> <!-- Added offset-md-1 to create space -->
    <div class="calculator bg-dark text-light border border-light p-4 rounded shadow-lg">


        <!-- Calculate Button -->
        <button class="btn btn-light w-100" id="calculatorinclude" onclick="calculatePayment()">Calculate CSB DED</button>

        <!-- Result Display -->
        <div class="result text-center mt-4 ">
            <span style="font-size:15px;">Monthly Payment: Php <span id="monthlyPayment">0.00</span></span>
        </div>
    </div>
</div>



















































<script>
// Function to add thousand separators to loan amount
function formatLoanAmount() {
let input = document.getElementById("loanAmount");
let value = input.value.replace(/,/g, ''); // Remove commas for calculation
let formattedValue = parseFloat(value).toLocaleString('en', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
input.value = formattedValue;
}

// Update interest rate based on terms
function updateInterestRate() {
    let terms = parseInt(document.getElementById("terms").value);
    let rateInput = document.getElementById("rate");

    if (terms >= 6 && terms <= 12) {
        rateInput.value = "7.50";
    } else if (terms >= 13 && terms <= 24) {
        rateInput.value = "9.00";
    } else {
        rateInput.value = "9.66";
    }
}

// Calculate payment using the PMT formula// Calculate payment using the PMT formula
function calculatePayment() {
    let loanAmount = parseFloat(document.getElementById("loanAmount").value.replace(/,/g, '')); // Remove commas
    let rate = parseFloat(document.getElementById("rate").value);
    let terms = parseInt(document.getElementById("terms").value);

    // Convert rate to a monthly interest rate
    let monthlyRate = rate / 100 / 12;

    // Excel PMT formula equivalent in JavaScript
    let monthlyPayment = -loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, terms)) / (Math.pow(1 + monthlyRate, terms) - 1);

    // Ensure payment is always positive
    monthlyPayment = Math.abs(monthlyPayment);
    monthlyPayment = Math.ceil(monthlyPayment * 100) / 100;

    // Format the payment as PHP currency
    const formattedPayment = `₱${monthlyPayment.toLocaleString('en', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

    // Display the result in the monthlyPayment cell
    document.getElementById("monthlyPayment").textContent = formattedPayment;

    // Update the monthlyPaymentCell with the formatted payment
    const monthlyPaymentCell = document.getElementById("monthlyPaymentCell");
    monthlyPaymentCell.textContent = formattedPayment; // Update the cell with the payment value
}

</script>



























<body>

    <div id="searchSectionLCS" class="container mt-5 d-none">
        
        <div translate="no">
        </div>
        
    
        <div class="row pt-2">
            <div class="col-12 d-flex">
                <input type="text" id="searchInputLCS" class="form-control" placeholder="Employee Number..." style="flex-grow: 1;">
                <button id="searchButtonLCS" class="btn btn-primary ml-2">Search</button>
            </div>
            <!-- Loading GIF -->
            <div id="loadingIndicatorLCS" style="display: none; text-align: center;">
                <img src="loading.gif" alt="Loading..." style="max-width: 100px;">
            </div>
        </div>
    </div>
    
    <br/>
    
    <!-- Section to display employee detailLCSs -->
    <div class="container pb-5 mb-5">
        
        <h4 class="text-center pt-5 pb-3 mb-2">LOAN ACCOUNTS</h4>
        <div class="row">
            <div class="col-md-12">
                <h3 id="employeeInfoLCS" style="font-size:12px" class="text-white"></h3>
            </div>
        </div>
        <div class="row results rounded-bottom rounded-top pb-5 mb-5" style="font-size:10px" id="resultsLCS">
            <!-- Table will be dynamically inserted here -->
        </div>
    </div>
    
    








    <div style="height:300px"></div>












    
    
    <script>
    
    
    // =====================================================================================================
    // INDEX 3 =============================================================================================
    // =====================================================================================================
    
    

    
    
    
    document.addEventListener('DOMContentLoaded', () => {
                const prompt = document.getElementById('fullscreenPrompt');
    
                // Show the prompt when the mouse moves
                document.addEventListener('mousemove', () => {
                    prompt.style.display = 'block';
                });
    
                // Enter fullscreen when the prompt is clicked
                prompt.addEventListener('click', () => {
                    openFullscreen();
                    prompt.style.display = 'none'; // Hide prompt after entering full-screen
                });
            });
    
            function openFullscreen() {
                const elem = document.documentElement;
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.mozRequestFullScreen) {
                    elem.mozRequestFullScreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                }
            }
    
    
    
    
    
    
    
    
    
    
    
    
        const csvFilesLCS = [
            'lcs_sep24.csv'
        ];
    
        document.getElementById('searchButtonLCS').addEventListener('click', searchEmployeeLCS);
    
        function searchEmployeeLCS() {
            const searchInputLCS = document.getElementById('searchInputLCS').value.trim();
            const loadingIndicatorLCS = document.getElementById('loadingIndicatorLCS');
    
            if (!searchInputLCS) {
                alert('Please enter an employee number.');
                return;
            }
    
            const resultsSectionLCS = document.getElementById('resultsLCS');
            const employeeInfoSectionLCS = document.getElementById('employeeInfoLCS');
            resultsSectionLCS.innerHTML = ''; // Clear previous results
            employeeInfoSectionLCS.innerHTML = ''; // Clear previous employee info
            loadingIndicatorLCS.style.display = 'block'; // Show loading indicator
    
            const last12MonthsFilesLCS = csvFilesLCS.slice(0, 12);
    
            let fetchedDataLCS = [];
    
            Promise.all(last12MonthsFilesLCS.map(csvFile => fetchCSVLCS(csvFile)))
                .then(allData => {
                    fetchedDataLCS = allData.filter(data => data !== null);
                    if (fetchedDataLCS.length === 0) {
                        alert('No valid data found in the provided files.');
                        return;
                    }
                    fetchedDataLCS.sort((a, b) => b.date - a.date);
                    displayEmployeeInfoLCS(fetchedDataLCS[0].monthName, fetchedDataLCS[0].csvData);
                    displayResultsTableLCS(fetchedDataLCS);
                })
           
                .finally(() => {
                    loadingIndicatorLCS.style.display = 'none'; // Hide loading indicator
                });
        }
        
    
        function fetchCSVLCS(csvFile) {
            return new Promise((resolve, reject) => {
                const monthName = getMonthNameFromCsvLCS(csvFile);
                const date = getDateFromCsvLCS(csvFile);
    
                fetch(csvFile)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Unable to fetch ${csvFile}. Status: ${response.status}`);
                        }
                        return response.text();
                    })
                    .then(text => {
                        const csvData = parseCSVLCS(text);
                        resolve({ monthName, csvData, date });
                    })
                    .catch(error => {
                        console.error(`Error fetching data for ${monthName}:`, error);
                        resolve(null);
                    });
            });
        }
    
        
        function getDateFromCsvLCS(csvFile) {
            const fileName = csvFile.replace('lcs_', '');
            const monthMap = {
                'jan': 0, 'feb': 1, 'mar': 2, 'apr': 3, 'may': 4, 'jun': 5,
                'jul': 6, 'aug': 7, 'sep': 8, 'oct': 9, 'nov': 10, 'dec': 11
            };
            const monthPart = fileName.slice(0, 3);
            const yearPart = '20' + fileName.slice(3, 5);
            const monthIndex = monthMap[monthPart];
            return new Date(yearPart, monthIndex);
        }
    
        function getMonthNameFromCsvLCS(csvFile) {
            const fileName = csvFile.replace('lcs_', '');
            const monthMap = {
                'jan': 'January', 'feb': 'February', 'mar': 'March', 'apr': 'April', 'may': 'May', 'jun': 'June',
                'jul': 'July', 'aug': 'August', 'sep': 'September', 'oct': 'October', 'nov': 'November', 'dec': 'December'
            };
            const monthPart = fileName.slice(0, 3);
            const yearPart = '20' + fileName.slice(3, 5);
            return `${monthMap[monthPart]} ${yearPart}`;
        }
    
        function parseCSVLCS(data) {
            const rows = data.trim().split('\n');
            return rows.map(row => row.split(','));
        }
    
        function displayEmployeeInfoLCS(monthName, csvData) {
            const employeeInfoSectionLCS = document.getElementById('employeeInfoLCS');
            let employeeFound = false;
    
            for (let i = 1; i < csvData.length; i++) {
                const row = csvData[i];
                if (row.length < 4) continue;
                const empno = row[34];
                if (empno === document.getElementById('searchInputLCS').value.trim()) {
                    employeeFound = true;
    
                    const branch_name = row[1];
                    const custid = row[7];
                    const accountnumber = row[2];
                    const account_name = row[8];
                    const group_name = row[38];
                    const contact_no = row[46];
    
                    const ref_date = row[59];
    
                    const loanamount = row[15];
                    const monthlyamort = row[32];
    
    
                    const endingbalance = row[16];
                    const accruedint = row[40];
                    const overdueint = row[20];
                    const totalBalanceLCSLCS = row[16 + 20 + 40];
                    const adj_npl_bckt = row[63];
                    const dateGranted = row[13];
    
                    employeeInfoSectionLCS.innerHTML = `
                        <strong>BRANCH:</strong><b style="color:orange"> ${branch_name}</b><br/>
                        <strong>CUST ID:</strong><b style="color:orange">   ${custid} </b><br/>
                       
                        <strong>ACC NAME:</strong><b style="color:orange"> ${account_name}</b><br/>
                            <strong>SCHOOL:</strong><b style="color:orange"> ${group_name}</b><br/>

                            
                            <strong>CONTACT:</strong>
<a href="tel:+63${contact_no}" style="color:orange; text-decoration:underline;">
  +63 ${contact_no}
</a><br/>

                        <strong>REF DATE:</strong><b style="color:orange"> ${ref_date}</b><br/>
    
    
    
                    `;
                    break;
                }
            }
    
            if (!employeeFound) {
                employeeInfoSectionLCS.innerHTML = 'No employee found in the latest data.';
            }
        }
        function displayResultsTableLCS(fetchedDataLCS) {
            const resultsSectionLCS = document.getElementById('resultsLCS');
            const table = document.createElement('table');
            table.classList.add('table', 'table-sm', 'table-bordered', 'table-striped', 'text-white'); // Adjust classes as necessary
    
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = `
                <th>Account Number</th>
                <th>Date Granted</th>
                <th>Loan Amount</th>
                <th>Monthly Amort</th>
                <th>Ending Balance</th>
                <th>Accrued Interest</th>
                <th>Overdue Interest</th>
                <th>Total Balance</th>
                <th>Adj NPL Bucket</th>
            `;
            thead.appendChild(headerRow);
            table.appendChild(thead);
    
            const tbody = document.createElement('tbody');

     // Initialize totals
     let totalLoanAmountLCS = 0;
    let totalMonthlyAmortLCS = 0;
    let totalBalanceLCS = 0;
    let totalAccruedInterestLCS = 0;
    let totalOverdueInterestLCS = 0;
    let totalEndingBalanceLCS = 0;

    
            fetchedDataLCS.forEach(data => {
                data.csvData.forEach((row, index) => {
                    if (index === 0) return; // Skip header row
    
                    const empno = row[34];
                    if (empno === document.getElementById('searchInputLCS').value.trim()) {
                        const loanAmount = parseFloat(row[15]) || 0;
                        const monthlyAmort = parseFloat(row[32]) || 0;
                        const endingBalance = parseFloat(row[16]) || 0;
                        const accruedInt = parseFloat(row[40]) || 0;
                        const overdueInt = parseFloat(row[20]) || 0;
                        const totalBal = endingBalance + accruedInt + overdueInt; // Adjust as needed
                        const adjNplBckt = row[63] || '';
                        const dateGranted = row[13] || '';

     // Accumulate totals
                totalLoanAmountLCS += loanAmount;
                totalMonthlyAmortLCS += monthlyAmort;
                totalBalanceLCS += totalBal;
                totalAccruedInterestLCS += accruedInt;
                totalOverdueInterestLCS += overdueInt;
                totalEndingBalanceLCS += endingBalance;

    
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
            <td>${row[2]}</td>
                    <td>${dateGranted}</td> <!-- Display formatted Date Granted -->
                    <td>${loanAmount.toLocaleString('en-US', { style: 'currency', currency: 'PHP' })}</td>
                    <td>${monthlyAmort.toLocaleString('en-US', { style: 'currency', currency: 'PHP' })}</td>
                    <td>${endingBalance.toLocaleString('en-US', { style: 'currency', currency: 'PHP' })}</td>
                    <td>${accruedInt.toLocaleString('en-US', { style: 'currency', currency: 'PHP' })}</td>
                    <td>${overdueInt.toLocaleString('en-US', { style: 'currency', currency: 'PHP' })}</td>
                    <td>${totalBal.toLocaleString('en-US', { style: 'currency', currency: 'PHP' })}</td>
                    <td>${adjNplBckt}</td>
                `;
                        tbody.appendChild(tr);
                    }
                });
            });
    
            table.appendChild(tbody);
    
            // Create footer for totals
            const tfoot = document.createElement('tfoot');
            const footerRow = document.createElement('tr');
            footerRow.innerHTML = `
            <th>Total</th>
      <th></th> <!-- Empty for Date Granted column -->
      <th>${totalLoanAmountLCS.toLocaleString('en-US', { style: 'currency', currency: 'PHP' })}</th>
      <th>${totalMonthlyAmortLCS.toLocaleString('en-US', { style: 'currency', currency: 'PHP' })}</th>
      <th>${totalEndingBalanceLCS.toLocaleString('en-US', { style: 'currency', currency: 'PHP' })}</th>
      <th>${totalAccruedInterestLCS.toLocaleString('en-US', { style: 'currency', currency: 'PHP' })}</th>
      <th>${totalOverdueInterestLCS.toLocaleString('en-US', { style: 'currency', currency: 'PHP' })}</th>
      <th>${totalBalanceLCS.toLocaleString('en-US', { style: 'currency', currency: 'PHP' })}</th>
      <th></th>
            `;
            tfoot.appendChild(footerRow);
            table.appendChild(tfoot);
    
            resultsSectionLCS.appendChild(table);
    
    
            resultsMap.forEach((data, monthName) => {
                const row = document.createElement('tr');
                row.innerHTML = `
    
            
             <td>${detailLCS.branch_name}</td>
                <td>${detailLCS.custid}</td>
                <td>${detailLCS.accountnumber}</td>
                <td>${detailLCS.dateGranted}</td>
                <td>${detailLCS.account_name}</td>
                <td>${detailLCS.group_name}</td>
                <td>${detailLCS.contact_no}</td>
                <td>${detailLCS.ref_date}</td>
                <td>${detailLCS.loanamount}</td>
                <td>${detailLCS.monthlyamort}</td>
                <td>${detailLCS.endingbalance}</td>
                <td>${detailLCS.accruedint}</td>
                <td>${detailLCS.overdueint}</td>
                <td>${detailLCS.totalBalanceLCSLCS}</td>
                <td>${detailLCS.adj_npl_bckt}</td>
    
                `;
                tbody.appendChild(row);
                const detailLCSRow = document.createElement('tr');
        const detailLCSCell = document.createElement('td');
        detailLCSCell.setAttribute('colspan', 2);
        detailLCSCell.innerHTML = `
    
    `;
    
    
    
    









    
    
    
    
    function calculateTotal() {
        const checkboxes = document.querySelectorAll('.dedamt-checkbox');
        let total = 0;
    
        checkboxes.forEach(checkbox => {
            if (checkbox.checked) {
                total += parseFloat(checkbox.dataset.dedamt);
            }
        });
    
        // Update the total display
        const totalDisplay = document.querySelector('#totalAmount');
        totalDisplay.innerText = `₱${total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
    }
    
    // Event listener for checkbox changes
    document.addEventListener('change', (event) => {
        if (event.target.classList.contains('dedamt-checkbox')) {
            calculateTotal();
        }
    });
    
    // Initial calculation on page load
    document.addEventListener('DOMContentLoaded', calculateTotal);
    
    
    
    
    
    
    
    
        detailLCSRow.appendChild(detailLCSCell);
        tbody.appendChild(detailLCSRow);
    
            });
    
            table.appendChild(tbody);
            resultsSectionLCS.appendChild(table);
        }
    
        function convertMonth(monthNumber) {
            const monthNames = ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"];
            return monthNames[parseInt(monthNumber, 10) - 1];
        }
    </script>























</body>

</html>
