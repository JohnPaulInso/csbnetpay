<!DOCTYPE html>
<html lang="en">
<head>
    <title>Historical Netpay</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.png" type="image/png" sizes="any">
</head>

<body>

<nav style="background-color: #003d6b; position: sticky; top: 0; z-index: 1000; padding: 0.5rem 1rem;">
    <div class="navbar-nav" style="color:#ddd;display: flex; justify-content: center;">
        <div style="color:#ddd;display: flex; align-items: center;">
            <a style="color:#aaa;" class="nav-item nav-link p-2" href="index.html"><b>NETPAY</b></a>
            <a style="color:#aaa;" class="nav-item nav-link p-2" href="index2.html"><b>DEDAMT</b></a>
            <a style="color:#aaa;" class="nav-item nav-link p-2" href="index3.html"><b>ONQUEUE</b></a>
            <a style="color:#aaa;" class="nav-item nav-link p-2" href="index4.html"><b>PLI</b></a>
            <a class="nav-item nav-link p-2 text-white" href="index5.html"><b>LE</b></a>
        </div>
    </div>
</nav>













<!-- NETPAY Section --><div class="container mt-5">
    <h1 class="text-center pt-5 pb-3 mb-2">LOAN EVALUATION</h1>
    <div class="row">
        <div id="searchSectionNetpay" class="col-md-12">
            <div class="row pt-2">
                <a>4694264</p>
                <div class="col-12 d-flex">
                    <input type="text" id="searchInputNetpay" class="form-control" placeholder="Employee Number..." style="flex-grow: 1;" oninput="syncInputs(this.value)">
                    <button id="searchButtonNetpay" class="btn btn-primary ml-2" onclick="triggerAllSearches()">Search</button>
                </div>
                <div id="loadingIndicatorNetpay" style="display: none; text-align: center;">
                    <img src="loading.gif" alt="Loading..." style="max-width: 100px;">
                </div>
            </div>
        </div>

        

    </div>
</div>













<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h3 id="employeeInfoNetpay" class="text-white"></h3>
        </div>
    </div>
    </div>
</div>





<!-- DEDAMT Section -->
<div id="searchSectionPos" class="container mt-5 d-none">
    <h1 class="text-center pt-5 pb-3 mb-2">DEDAMT POSITIVE</h1>
    <div class="row pt-2">
        <div class="col-12 d-flex">
            <input type="text" id="searchInputPos" class="form-control" placeholder="Employee Number..." style="flex-grow: 1;" oninput="syncInputs(this.value)">
            <button id="searchButtonPos" class="btn btn-primary ml-2" >Search</button>
        </div>
        <div id="loadingIndicatorPos" style="display: none; text-align: center;">
            <img src="loading.gif" alt="Loading..." style="max-width: 100px;">
        </div>
    </div>
</div>
<br/>
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h3 id="employeeInfoPos" class="text-white"></h3>
        </div>
    </div>
    </div>
</div>

<!-- ONQUEUE Section -->
<div id="searchSectionOnq" class="container mt-5 d-none">
    <h1 class="text-center pt-5 pb-3 mb-2">ONQUEUE</h1>
    <div class="row pt-2">
        <div class="col-12 d-flex">
            <input type="text" id="searchInputOnq" class="form-control" placeholder="Employee Number..." style="flex-grow: 1;" oninput="syncInputs(this.value)">
            <button id="searchButtonOnq" class="btn btn-primary ml-2">Search</button>
        </div>
        <div id="loadingIndicatorOnq" style="display: none; text-align: center;">
            <img src="loading.gif" alt="Loading..." style="max-width: 100px;">
        </div>
    </div>
</div>
<br/>
<div class="container ">
    <div class="row">
        <div class="col-md-12">
            <h3 id="employeeInfoOnq" class="text-white"></h3>
        </div>
    </div>
    </div>
</div>

<!-- PLI Section -->
<div id="searchSectionPLI" class="container mt-5 d-none">
    <h1 class="text-center pt-5 pb-3 mb-2">PLI DEDUCTION</h1>
    <div class="row pt-2">
        <div class="col-12 d-flex">
            <input type="text" id="searchInputPLI" class="form-control" placeholder="Employee Number..." style="flex-grow: 1;" oninput="syncInputs(this.value)">
            <button id="searchButtonPLI" class="btn btn-primary ml-2">Search</button>
        </div>
        <div id="loadingIndicatorPLI" style="display: none; text-align: center;">
            <img src="loading.gif" alt="Loading..." style="max-width: 100px;">
        </div>
    </div>
</div>
<br/>
<div class="container  ">
    <div class="row">
        <div class="col-md-12">
            <h3 id="employeeInfoPLI" class="text-white"></h3>
        </div>
    </div>
    </div>
</div>














<script>

    // Function to update the netpayCell
function updateNetPayCell() {
    var netPayValue = document.getElementById("netpaytable").innerHTML;
    document.getElementById("netpayCell").innerHTML = netPayValue;
}

// Create a MutationObserver to watch for changes
var observer = new MutationObserver(function(mutations) {
    updateNetPayCell(); // Call the update function whenever a mutation occurs
});

// Target the node to observe
var targetNode = document.getElementById("netpaytable");

// Observer options
var config = { childList: true, subtree: true };

// Start observing
if (targetNode) {
    observer.observe(targetNode, config);
}

// Initial update
updateNetPayCell();

</script>












<div style="margin-top: 10px;">
    
    <table style="width: 100%; border-collapse: collapse; text-align: left;">
        


        

<!-- 
            <tr class="row results d-nones" >
                <td id="resultsPLI"></td>
                <td></td>
            </tr> -->


        
        <tr>
            <td id="A1" style="border: 1px solid #ccc; padding: 8px; background-color: #4d4d00;">NETPAY:</td>
            <td id="resultsNetpay" style="border: 1px solid #ccc; padding: 8px; background-color: #4d4d00;">This must change to the same value as #totalAmount td</td>
        </tr>



        
        <tr>
            <td id="A2"style="border: 1px solid #ccc; padding: 8px; background-color: #4d4d00;">POSITIVE:</td>
            <td id="resultspos" style="border: 1px solid #ccc; padding: 8px; background-color: #4d4d00;">This must change to the same value as #totalAmount td</td>
        </tr>


        <tr>
            <td id="A3" style="border: 1px solid #ccc; padding: 8px; background-color: green; color: white;">NETPAY & OLD CSB SUB TOTAL:</td>
            <td id="netpaypositivetotalvalue" style="border: 1px solid #ccc; padding: 8px; background-color: green; color: white;">Total of #netpaytable + #positivetable</td>
        </tr>
        


                


            <tbody>
                <tr class="mt-5">
                    <td id="A4" style="border: 1px solid #ccc; padding: 8px;">ADD: ABSENCES/PVP</td>
                    <td style="border: 1px solid #ccc; padding: 8px;" id="resultsPLI1"></td>
                </tr>
                <tr>
                    
                    <td  id="A5" style="border: 1px solid #ccc; padding: 8px;">ADD: REDEMPTION PLI 1 STOPPAGE</td>
                    <td style="border: 1px solid #ccc; padding: 8px;" id="resultsPLI2"></td>
            
                </tr>
                <tr>
                    <td  id="A6" style="border: 1px solid #ccc; padding: 8px;">ADD: REDEMPTION PLI 2</td>
                    <td style="border: 1px solid #ccc; padding: 8px;" id="resultsPLI3"></td>
              
                </tr>
                <tr>
                    <td id="A7"  style="border: 1px solid #ccc; padding: 8px;">ADD: REDEMPTION PLI 3</td>
                    <td style="border: 1px solid #ccc; padding: 8px;" id="resultsPLI4"></td>
            
                </tr>
                <tr>
                    <td  id="A8" style="border: 1px solid #ccc; padding: 8px;">ADD: REDEMPTION PLI 4</td>
                    <td style="border: 1px solid #ccc; padding: 8px;" id="resultsPLI5"></td>
            
                
                
                
                </tr>
                <tr>
                    <td  id="A10" style="border: 1px solid #ccc; padding: 8px;">ADD: ANTICIPATION:</td>
                    <td  id="anticipation" style="border: 1px solid #ccc; padding: 8px;"><input type="number" value="10000" class="input-field" /></td>
                </tr>
                <tr>
                    <td  id="A11" style="border: 1px solid #ccc; padding: 8px;">ADD: PROMOTION:</td>
                    <td  id="promotion" style="border: 1px solid #ccc; padding: 8px;"><input type="number" value="20000" class="input-field" /></td>
                </tr>
                <tr>
                    <td id="A12" style="border: 1px solid #ccc; padding: 8px; background-color: #200000; color: white;">PLI TOTAL:</td>
                    <td id="plitotalvalue" style="border: 1px solid #ccc; padding: 8px; background-color: #200000; color: white;">â‚±0.00</td>
                </tr>
                
            </tbody>
        

        <script>
            // Function to calculate the total
            function calculateTotal() {
                const inputs = document.querySelectorAll('.input-field');
                let total = 0;
        
                // Loop through each input field and add its value to the total
                inputs.forEach(input => {
                    total += parseFloat(input.value) || 0; // Convert value to float and handle NaN
                });
        
                // Format the total as PHP currency (Philippine pesos)
                const formattedTotal = total.toLocaleString('en-PH', { style: 'currency', currency: 'PHP', minimumFractionDigits: 2, maximumFractionDigits: 2 });
        
                // Update the total in the designated element
                document.getElementById('plitotalvalue').innerText = formattedTotal;
            }
        
            // Add event listeners to each input field to calculate the total on input
            document.querySelectorAll('.input-field').forEach(input => {
                input.addEventListener('input', calculateTotal);
            });
        
            // Initial calculation in case there are preset values
            calculateTotal();





                // JavaScript to handle the calculation
                document.addEventListener('DOMContentLoaded', function() {
    const plitotalvalueInput = document.getElementById('plitotalvalue');
    const resultsonqs = document.getElementsByClassName('resultsonq');
    const semiTotalValueInput = document.getElementById('semiTotalValue');

    function updateSemiTotalValue() {
        const plitotalvalue = parseFloat(plitotalvalueInput.value) || 0;

        // Extract the numeric value from the totalAmount cell
        const resultsonqValue = parseFloat(resultsonqs.innerText.replace(/[â‚±,]/g, '').trim()) || 0;
        
        const semiTotalValue = plitotalvalue - resultsonqValue;

        semiTotalValueInput.value = semiTotalValue.toFixed(2); // Format to 2 decimal places
    }

    // Add input event listeners
    plitotalvalueInput.addEventListener('input', updateSemiTotalValue);
    // Call updateSemiTotalValue when the page loads to set initial value
    updateSemiTotalValue();
});

        </script>
        










        <tr>
            <td style="border: 1px solid #ccc; padding: 8px; background-color: #4d4d00;">LESS: ONQUEUE:</td>
            <!-- <td class="resultsonq d-none" style="visibility:hidden;border: 1px solid #ccc; padding: 8px; background-color: #4d4d00;"></td> -->
     
     
                <td  id="resultsonq"  style="border: 1px solid #ccc; padding: 8px; background-color: #4d4d00;"> </td>
      
        </tr>


        
        <tr>
            <td style="border: 1px solid #ccc; padding: 8px; background-color: green; color: white;">SEMI TOTAL:</td>
            <td id="semiTotalValue" style="border: 1px solid #ccc; padding: 8px; background-color: green; color: white;">â‚±0.00</td>
</tr>
        <tr>
            <td style="border: 1px solid #ccc; padding: 8px;">LESS: NEW CSB DED:</td>
            <td id="monthlyPaymentCell" style="border: 1px solid #ccc; padding: 8px;">MONTHLY PAYMENT FROM CALCULATOR RESULT </td>
        </tr>
        <tr>
            <td style="border: 1px solid #ccc; padding: 8px; background-color: green; color: white;">NEW NETPAY:</td>
            <td  id="finalTotalValue" style="border: 1px solid #ccc; padding: 8px; background-color: green; color: white;">semiTotalValue minus monthlyPaymentCell</td>

        </tr>

        
    </table>

    <div class="d-flex justify-content-center mt-5">
        <button class="btn btn-success" onclick="calculateAll()">CALCULATE ALL</button>
    </div>
    











    
    <script>
    
    function calculateAll() {
    // Helper function to get the numeric value
    function getNumericValue(id) {
        const element = document.getElementById(id);
        if (element) {
            // Get only the text nodes by excluding child elements
            const textContent = Array.from(element.childNodes)
                .filter(node => node.nodeType === Node.TEXT_NODE) // Only keep text nodes
                .map(node => node.textContent)
                .join(''); // Join text content

            // Parse the numeric value while removing currency symbols and commas
            return parseFloat(textContent.replace(/[â‚±, ]/g, '').trim()) || 0;
        } else {
            console.error(`Element with ID "${id}" not found.`);
            return 0; // Return 0 if the element does not exist
        }
    }

    // Get numeric values from table cells
    const resultsNetpay = getNumericValue("resultsNetpay");
    const resultspos = getNumericValue("resultspos");
    const pliTotalValue = getNumericValue("plitotalvalue");
    const resultsonq = getNumericValue("resultsonq");
    const monthlyPaymentCell = getNumericValue("monthlyPaymentCell");

    // Get additional values from table cells
    const resultsPLI1 = getNumericValue("resultsPLI1"); // Change to the correct ID
    const resultsPLI2 = getNumericValue("resultsPLI2"); // Change to the correct ID
    const resultsPLI3 = getNumericValue("resultsPLI3"); // Change to the correct ID
    const resultsPLI4 = getNumericValue("resultsPLI4"); // Change to the correct ID
    const resultsPLI5 = getNumericValue("resultsPLI5"); // Extract value from resultsPLI5
    const anticipation = getNumericValue("anticipation");
    const promotion = getNumericValue("promotion");

    // Calculate total additions
    const totalAdditions = resultsPLI1 + resultsPLI2 + resultsPLI3 + resultsPLI4 + resultsPLI5 + anticipation + promotion;

    // First calculation: Adding resultsNetpay + resultspos + totalAdditions
    const netpayPositiveTotal = resultsNetpay + resultspos + totalAdditions;
    document.getElementById("netpaypositivetotalvalue").textContent = `â‚±${netpayPositiveTotal.toFixed(2)}`;

    // Second calculation: PLI Total - On Queue
    const semiTotalValue = pliTotalValue - resultsonq;
    document.getElementById("semiTotalValue").textContent = `â‚±${semiTotalValue.toFixed(2)}`;

    // Final calculation: Semi Total - Monthly Payment
    const finalTotalValue = semiTotalValue - monthlyPaymentCell;
    document.getElementById("finalTotalValue").textContent = `â‚±${finalTotalValue.toFixed(2)}`;
}





</script>







    
    <div class="container pt-5 pb-5 mt-5 mb-5"></div>
</div>



<script>
    document.getElementById('searchButton').addEventListener('click', function() {
        // Simulate showing the tables (in reality, this should come from your search logic)
        document.getElementById('netpaytable').style.display = 'block';
        document.getElementById('positivetable').style.display = 'block';
        document.getElementById('totalAmount').style.display = 'block';
    
        // Call the function to update values after a short delay to allow the DOM to update
        setTimeout(updateValues, 100); // Adjust delay if needed
    });
    
    function updateValues() {
        // Get values from the referenced tables
        const netpayCell = document.querySelector('#netpaytable td');
        const posCell = document.querySelector('#positivetable td');
        // const resultsonq = document.querySelector('#totalAmount td');
    
        // Only update if the cells have values
        if (netpayCell && netpayCell.innerText) {
            document.getElementById('netpayCell').innerText = netpayCell.innerText;
        }
        if (posCell && posCell.innerText) {
            document.getElementById('posCell').innerText = posCell.innerText;
        }
        if (resultsonq && resultsonq.innerText) {
            document.getElementById('resultsonq').innerText = resultsonq.innerText;
        }
    }
    </script>
    




















<SCRIPT>




    
document.addEventListener('DOMContentLoaded', () => {
        const prompt = document.getElementById('fullscreenPrompt');

        // Show the prompt when the mouse moves
        document.addEventListener('mousemove', () => {
            prompt.style.display = 'block';
        });

        // Enter fullscreen when the prompt is clicked
        prompt.addEventListener('click', () => {
            openFullscreen();
            prompt.style.display = 'none'; // Hide prompt after entering full-screen
        });
    });

    function openFullscreen() {
        const elem = document.documentElement;
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        } else if (elem.mozRequestFullScreen) {
            elem.mozRequestFullScreen();
        } else if (elem.webkitRequestFullscreen) {
            elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen();
        }
    }



    
        const csvFilesNetpay = [
            'aug24.csv'
        ];
        
    document.getElementById('searchButtonNetpay').addEventListener('click', searchEmployeeNetpay);

    function searchEmployeeNetpay() {
    const searchInputNetpay = document.getElementById('searchInputNetpay').value.trim();
    const loadingIndicatorNetpay = document.getElementById('loadingIndicatorNetpay');

    if (!searchInputNetpay) {
        alert('Please enter an employee number.');
        return;
    }

    const Netpay = document.getElementById('resultsNetpay');
    const employeeInfoSectionNetpay = document.getElementById('employeeInfoNetpay');
    Netpay.innerHTML = ''; // Clear previous results
    employeeInfoSectionNetpay.innerHTML = ''; // Clear previous employee info
    loadingIndicatorNetpay.style.display = 'block'; // Show loading indicator

    // Automatically limit to the last 12 months (latest first)
    const last12MonthsFilesNetpay = csvFilesNetpay.slice(0, 12);

    let fetchedDataNet = [];
    let latestCsvDataNetpay = null;

    Promise.all(last12MonthsFilesNetpay.map(csvFile => fetchCSVNetpay(csvFile)))
        .then(allData => {
            fetchedDataNet = allData;
            fetchedDataNet.sort((a, b) => b.date - a.date);
            latestCsvDataNetpay = fetchedDataNet[0].csvData;
            displayEmployeeInfoNetpay(fetchedDataNet[0].monthName, latestCsvDataNetpay);
            displayResultsTableNetpay(fetchedDataNet);
        })
        .catch(error => {
            console.error('Error fetching CSV data:', error);
        })
        .finally(() => {
            loadingIndicatorNetpay.style.display = 'none'; // Hide loading indicator
        });
}


    function fetchCSVNetpay(csvFile) {
        return new Promise((resolve, reject) => {
            const monthName = getMonthNameFromCsvNetpay(csvFile);
            const date = getDateFromCsvNetpay(csvFile);

            fetch(csvFile)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Unable to fetch ${csvFile}`);
                    }
                    return response.text();
                })
                .then(text => {
                    const csvData = parseCSVNetpay(text);
                    resolve({ monthName, csvData, date });
                })
                .catch(error => {
                    console.error(`Error fetching data for ${monthName}:`, error);
                    reject(error);
                });
        });
    }

    function getDateFromCsvNetpay(csvFile) {
        const monthMap = {
            'jan': 0, 'feb': 1, 'mar': 2, 'apr': 3, 'may': 4, 'jun': 5,
            'jul': 6, 'aug': 7, 'sep': 8, 'oct': 9, 'nov': 10, 'dec': 11
        };
        const monthPart = csvFile.slice(0, 3);
        const yearPart = '20' + csvFile.slice(3, 5);
        const monthIndex = monthMap[monthPart];
        return new Date(yearPart, monthIndex);
    }

    function getMonthNameFromCsvNetpay(csvFile) {
        const monthMap = {
            'jan': 'January', 'feb': 'February', 'mar': 'March', 'apr': 'April', 'may': 'May', 'jun': 'June',
            'jul': 'July', 'aug': 'August', 'sep': 'September', 'oct': 'October', 'nov': 'November', 'dec': 'December'
        };
        const monthPart = csvFile.slice(0, 3);
        const yearPart = '20' + csvFile.slice(3, 5);
        return `${monthMap[monthPart]} ${yearPart}`;
    }

    function parseCSVNetpay(data) {
        const rows = data.trim().split('\n');
        return rows.map(row => row.split(','));
    }

    function displayEmployeeInfoNetpay(monthName, csvData) {
        const employeeInfoSectionNetpay = document.getElementById('employeeInfoNetpay');
        let employeeFound = false;

        for (let i = 1; i < csvData.length; i++) {
            const row = csvData[i];
            if (row.length < 4) continue;
            const empno = row[3];
            if (empno === document.getElementById('searchInputNetpay').value.trim()) {
                employeeFound = true;

                const div = row[1];
                const sta = row[2];
                const fname = row[4];
                const mi = row[5];
                const lname = row[6];
                const account = row[8];

                employeeInfoSectionNetpay.innerHTML = `
                  <strong>NAME:</strong><b style="color:orange"> ${fname} ${mi} ${lname}</b><br/>
                    <strong>EMPNO:</strong><b style="color:orange">   ${empno} </b><br/>
                    <strong>DIV / STA:</strong><b style="color:orange"> ${div} / ${sta}</b><br/>
                
                `;
                break;
            }
        }

        if (!employeeFound) {
            employeeInfoSectionNetpay.innerHTML = 'No employee found in the latest data.';
        }
    }






    function displayResultsTableNetpay(fetchedDataNet) {
    const resultsSectionNetpay = document.getElementById('resultsNetpay');
    
    // Clear previous results
    resultsSectionNetpay.innerHTML = '';

    let totalNetPay = 0; // Variable to hold the total net pay

    // Iterate over the fetched data and add rows to the results section
    fetchedDataNet.forEach(data => {
        data.csvData.forEach((row, index) => {
            if (index === 0) return; // Skip header row
            if (row.length < 4) return; // Skip malformed rows

            const empno = row[3];
            if (empno === document.getElementById('searchInputNetpay').value.trim()) {
                const monthName = data.monthName;
                const takehome = parseFloat(row[7]);
                totalNetPay += takehome; // Accumulate total net pay

                const formattedTakehome = takehome.toLocaleString('en-PH', { style: 'currency', currency: 'PHP' });

                const rowElement = document.createElement('tr');
                rowElement.innerHTML = `
    <!-- <tr>${monthName} NETPAY</tr> -->
                    <tr id="netpaytable"><b>${formattedTakehome}</b></tr>
                `;
                resultsSectionNetpay.appendChild(rowElement); // Append directly to the results section
            }
        });
    });

    if (totalNetPay > 0) {
        // Only calculate total if there's net pay to display
        calculateAndDisplayTotal(totalNetPay);
    }
}

function calculateAndDisplayTotal(totalNetPay) {
    // Get the positivetable value (assuming it's already populated elsewhere)
    const positiveValue = document.getElementById('positivetable').textContent.replace(/[^\d.-]/g, '') || 0;

    // Calculate total
    const total = parseFloat(totalNetPay) + parseFloat(positiveValue);

    // Display the total in netpaypositivetotalvalue element
    document.getElementById('netpaypositivetotalvalue').textContent = total.toLocaleString('en-PH', { style: 'currency', currency: 'PHP' });
}



    











































const csvFilesPos = [
    'pos_aug24.csv'
];

document.getElementById('searchButtonPos').addEventListener('click', searchEmployeePos);

function searchEmployeePos() {
    const searchInputPos = document.getElementById('searchInputPos').value.trim();
    const loadingIndicatorPos = document.getElementById('loadingIndicatorPos');

    if (!searchInputPos) {
        alert('Please enter an employee number.');
        return;
    }

    const resultsSectionPos = document.getElementById('resultspos');
    const employeeInfoSectionPos = document.getElementById('employeeInfoPos');
    resultsSectionPos.innerHTML = ''; // Clear previous results
    employeeInfoSectionPos.innerHTML = ''; // Clear previous employee info
    loadingIndicatorPos.style.display = 'block'; // Show loading indicator

    // Automatically limit to the last 12 months (latest first)
    const last12MonthsFilesPos = csvFilesPos.slice(0, 12);

    let fetchedDataPos = [];

    Promise.all(last12MonthsFilesPos.map(csvFile => fetchCSVPos(csvFile)))
        .then(allData => {
            fetchedDataPos = allData.filter(data => data !== null); // Filter out failed fetches
            if (fetchedDataPos.length === 0) {
                alert('No valid data found in the provided files.');
                return;
            }
            fetchedDataPos.sort((a, b) => b.date - a.date);
            displayEmployeeInfoPos(fetchedDataPos[0].monthName, fetchedDataPos[0].csvData);
            displayResultsTablePos(fetchedDataPos);
        })
        .catch(error => {
            console.error('Error fetching CSV data:', error);
            alert('Error fetching data. Check the console for more details.');
        })
        .finally(() => {
            loadingIndicatorPos.style.display = 'none'; // Hide loading indicator
        });
}

function fetchCSVPos(csvFile) {
    return new Promise((resolve, reject) => {
        const monthName = getMonthNameFromCsvPos(csvFile);
        const date = getDateFromCsvPos(csvFile);

        console.log(`Fetching data from file: ${csvFile}`);

        fetch(csvFile)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Unable to fetch ${csvFile}. Status: ${response.status}`);
                }
                return response.text();
            })
            .then(text => {
                console.log(`Successfully fetched data from ${csvFile}`);
                const csvData = parseCSVPos(text);
                resolve({ monthName, csvData, date });
            })
            .catch(error => {
                console.error(`Error fetching data for ${monthName}:`, error);
                resolve(null); // Return null for failed fetches, don't reject to allow Promise.all to proceed
            });
    });
}

function getDateFromCsvPos(csvFile) {
    const fileName = csvFile.replace('pos_', ''); // Remove 'pos_' prefix
    const monthMap = {
        'jan': 0, 'feb': 1, 'mar': 2, 'apr': 3, 'may': 4, 'jun': 5,
        'jul': 6, 'aug': 7, 'sep': 8, 'oct': 9, 'nov': 10, 'dec': 11
    };
    const monthPart = fileName.slice(0, 3);
    const yearPart = '20' + fileName.slice(3, 5);
    const monthIndex = monthMap[monthPart];
    return new Date(yearPart, monthIndex);
}

function getMonthNameFromCsvPos(csvFile) {
    const fileName = csvFile.replace('pos_', ''); // Remove 'pos_' prefix
    const monthMap = {
        'jan': 'January', 'feb': 'February', 'mar': 'March', 'apr': 'April', 'may': 'May', 'jun': 'June',
        'jul': 'July', 'aug': 'August', 'sep': 'September', 'oct': 'October', 'nov': 'November', 'dec': 'December'
    };
    const monthPart = fileName.slice(0, 3);
    const yearPart = '20' + fileName.slice(3, 5);
    return `${monthMap[monthPart]} ${yearPart}`;
}

function parseCSVPos(data) {
    const rows = data.trim().split('\n');
    return rows.map(row => row.split(','));
}

function displayEmployeeInfoPos(monthName, csvData) {
    const employeeInfoSectionPos = document.getElementById('employeeInfoPos');
    let employeeFound = false;

    for (let i = 1; i < csvData.length; i++) {
        const row = csvData[i];
        if (row.length < 4) continue;
        const empno = row[3];
        if (empno === document.getElementById('searchInputPos').value.trim()) {
            employeeFound = true;

            const div = row[1];
            const sta = row[2];
            const fname = row[4];
            const mi = row[5];
            const lname = row[6];

            employeeInfoSectionPos.innerHTML = `
                `;
            break;
        }
    }

    if (!employeeFound) {
        employeeInfoSectionPos.innerHTML = 'No employee found in the latest data.';
    }
}














function displayResultsTablePos(fetchedDataPos) {
    const resultsSectionPos = document.getElementById('resultspos');
    
    // Clear previous results
    resultsSectionPos.innerHTML = '';

    const resultsMap = new Map(); // To store sums and details for dropdown

    fetchedDataPos.forEach(data => {
    data.csvData.forEach((row, index) => {
        if (index === 0) return; // Skip header row
        if (row.length < 4) return; // Skip malformed rows

        const empno = row[3];
        if (empno === document.getElementById('searchInputPos').value.trim()) {
            const monthName = data.monthName;
            const termyy = parseFloat(row[12]);
            const termm = parseFloat(row[11]); 
            const dedamt = parseFloat(row[13]);
            
            // Accumulate amounts
            if (!resultsMap.has(monthName)) {
                resultsMap.set(monthName, { sum: 0, details: [] });
            }
            const entry = resultsMap.get(monthName);
            entry.sum += dedamt;
            entry.details.push(dedamt.toLocaleString('en-PH', { style: 'currency', currency: 'PHP' }));
entry.details.push(termyy.toLocaleString('en-PH'));
entry.details.push(termm.toLocaleString('en-PH'));
        }
    });
});



// Add aggregated results directly to the results section
const resultsTable = document.getElementById('resultsTable'); // Assume there's a table with this ID
resultsMap.forEach((value, monthName) => {
    const totalDedAmt = value.sum.toLocaleString('en-PH', { style: 'currency', currency: 'PHP' });
    
    const rowElement = document.createElement('tr');
    rowElement.innerHTML = `
        <td>
            <div class="position-relative">
                <u><b class="sum-amount" style="cursor: pointer">${totalDedAmt}</b></u>
                <div class="dropdown-menu p-1 pl-3" style="display: none; position: absolute; z-index: 1; width: 210px;"> 
                    <div style="display: flex; justify-content: space-between;"> <!-- Use flexbox for alignment -->
                        ${value.details.join(' / ')} <!-- Join details with a slash or space -->
                    </div>
                </div>
            </div>
        </td>
    `;
    
        // Add hover event listeners
        const sumAmount = rowElement.querySelector('.sum-amount');
        const dropdownMenu = rowElement.querySelector('.dropdown-menu');

        sumAmount.addEventListener('mouseenter', () => {
            dropdownMenu.style.display = 'block';
        });

        sumAmount.addEventListener('mouseleave', () => {
            dropdownMenu.style.display = 'none';
        });

        resultsSectionPos.appendChild(rowElement); // Append directly to the results section
    });
}



























































    const csvFilesOnq = [
        'onq_aug24.csv'
    ];

    document.getElementById('searchButtonOnq').addEventListener('click', searchEmployeeOnq);
   function searchEmployeeOnq() {
    const searchInputOnq = document.getElementById('searchInputOnq').value.trim();
    const loadingIndicatorOnq = document.getElementById('loadingIndicatorOnq');

    if (!searchInputOnq) {
        alert('Please enter an employee number.');
        return;
    }

    const resultsSectionOnq = document.getElementById('resultsonq');
    const employeeInfoSectionOnq = document.getElementById('employeeInfoOnq');
    resultsSectionOnq.innerHTML = ''; // Clear previous results
    employeeInfoSectionOnq.innerHTML = ''; // Clear previous employee info
    loadingIndicatorOnq.style.display = 'block'; // Show loading indicator

    const last12MonthsFilesOnq = csvFilesOnq.slice(0, 12);
    let fetchedDataOnq = [];

    Promise.all(last12MonthsFilesOnq.map(csvFile => fetchCSVOnq(csvFile)))
        .then(allData => {
            fetchedDataOnq = allData.filter(data => data !== null);
            if (fetchedDataOnq.length === 0) {
                alert('No valid data found in the provided files.');
                return;
            }
            fetchedDataOnq.sort((a, b) => b.date - a.date);
            displayEmployeeInfoOnq(fetchedDataOnq[0].monthName, fetchedDataOnq[0].csvData);
            displayResultsTableOnq(fetchedDataOnq);

            // Call the function to update the resultsonq after results are displayed
            updateresultsonq();

            // Automatically press the Calculate button and update the monthly payment
            calculateAndUpdateMonthlyPayment();
        })
        .catch(error => {
            console.error('Error fetching CSV data:', error);
            alert('Error fetching data. Check the console for more details.');
        })
        .finally(() => {
            loadingIndicatorOnq.style.display = 'none'; // Hide loading indicator
        });
}

function calculateAndUpdateMonthlyPayment() {
    // Simulate clicking the Calculate button




    
    calculatePayment();

    // Retrieve the value from the monthlyPayment span
    const monthlyPaymentValue = document.getElementById('monthlyPayment').textContent;

    // Update the monthlyPaymentCell with the retrieved value
    const monthlyPaymentCell = document.getElementById('monthlyPaymentCell');
    monthlyPaymentCell.textContent = monthlyPaymentValue; // Update the cell with the payment value

    // Get the semiTotalValue and calculate the new net pay
    const semiTotalValue = parseFloat(document.getElementById('semiTotalValue').textContent.replace(/â‚±/g, '').replace(/,/g, ''));

    // Extract the numeric value from the monthly payment and format it for calculation
    const monthlyPaymentNumeric = parseFloat(monthlyPaymentValue.replace(/â‚±/g, '').replace(/,/g, ''));

    // Calculate NEW NETPAY
    const newNetPay = semiTotalValue - monthlyPaymentNumeric;

    // Update the finalTotalValue with the new net pay
    document.getElementById('finalTotalValue').textContent = `â‚±${newNetPay.toFixed(2)}`;
}



function updateresultsonq() {
    const totalAmountCell = document.getElementsById('totalAmount');
    const totalAmountText = totalAmountCell.textContent || "";
    const totalAmountNumber = parseFloat(totalAmountText.replace(/[â‚±,]/g, '').trim());

    const resultsonq = document.getElementsById('resultsonq');
    resultsonq.textContent = `â‚±${totalAmountNumber.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;

    calculateSemiTotal();
}

function calculateSemiTotal() {
    const pliTotalCell = document.getElementById('plitotalvalue');
    const pliTotalText = pliTotalCell.textContent || "";
    const pliTotalValue = parseFloat(pliTotalText.replace(/[â‚±,]/g, '').trim());

    const resultsonq = document.getElementsByClassName('resultsonq');
    const onqueueText = resultsonq.textContent || "";
    const onqueueValue = parseFloat(onqueueText.replace(/[â‚±,]/g, '').trim());

    const semiTotalValue = pliTotalValue - onqueueValue;

    const semiTotalCell = document.getElementById('semiTotal');
    semiTotalCell.textContent = `â‚±${semiTotalValue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
}









    function fetchCSVOnq(csvFile) {
        return new Promise((resolve, reject) => {
            const monthName = getMonthNameFromCsvOnq(csvFile);
            const date = getDateFromCsvOnq(csvFile);

            fetch(csvFile)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Unable to fetch ${csvFile}. Status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(text => {
                    const csvData = parseCSVOnq(text);
                    resolve({ monthName, csvData, date });
                })
                .catch(error => {
                    console.error(`Error fetching data for ${monthName}:`, error);
                    resolve(null);
                });
        });
    }

    function getDateFromCsvOnq(csvFile) {
        const fileName = csvFile.replace('onq_', '');
        const monthMap = {
            'jan': 0, 'feb': 1, 'mar': 2, 'apr': 3, 'may': 4, 'jun': 5,
            'jul': 6, 'aug': 7, 'sep': 8, 'oct': 9, 'nov': 10, 'dec': 11
        };
        const monthPart = fileName.slice(0, 3);
        const yearPart = '20' + fileName.slice(3, 5);
        const monthIndex = monthMap[monthPart];
        return new Date(yearPart, monthIndex);
    }

    function getMonthNameFromCsvOnq(csvFile) {
        const fileName = csvFile.replace('onq_', '');
        const monthMap = {
            'jan': 'January', 'feb': 'February', 'mar': 'March', 'apr': 'April', 'may': 'May', 'jun': 'June',
            'jul': 'July', 'aug': 'August', 'sep': 'September', 'oct': 'October', 'nov': 'November', 'dec': 'December'
        };
        const monthPart = fileName.slice(0, 3);
        const yearPart = '20' + fileName.slice(3, 5);
        return `${monthMap[monthPart]} ${yearPart}`;
    }

    function parseCSVOnq(data) {
        const rows = data.trim().split('\n');
        return rows.map(row => row.split(','));
    }

    function displayEmployeeInfoOnq(monthName, csvData) {
        const employeeInfoSectionOnq = document.getElementById('employeeInfoOnq');
        let employeeFound = false;

        for (let i = 1; i < csvData.length; i++) {
            const row = csvData[i];
            if (row.length < 4) continue;
            const empno = row[3];
            if (empno === document.getElementById('searchInputOnq').value.trim()) {
                employeeFound = true;

                const div = row[1];
                const sta = row[2];
                const fname = row[4];
                const mi = row[5];
                const lname = row[6];

                employeeInfoSectionOnq.innerHTML = `
                  `;
                break;
            }
        }

        if (!employeeFound) {
            employeeInfoSectionOnq.innerHTML = 'No employee found in the latest data.';
        }

    }



    
    function displayResultsTableOnq(fetchedDataOnq) {
    const resultsSectionOnq = document.getElementById('resultsonq');

    const table = document.createElement('table');
    table.classList.add('table', 'table-borderless', 'text-white');

    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = `
       <!-- <th class="font-weight-bold">ONQUEUE MONTH</th>
        <th class="font-weight-bold">DEDAMT</th> -->
    `;
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement('tbody');
    const resultsMap = new Map();

    fetchedDataOnq.forEach(data => {
        data.csvData.forEach((row, index) => {
            if (index === 0) return;

            const empno = row[3];
            if (empno === document.getElementById('searchInputOnq').value.trim()) {
                const monthName = data.monthName;
                const dedamt = parseFloat(row[13]);

                if (!resultsMap.has(monthName)) {
                    resultsMap.set(monthName, { sum: 0, details: [] });
                }

                const dedcode = row[7];
                const effyy = row[9];
                const effmm = convertMonth(row[10]); // Convert month number
                const termyy = row[11];
                const termmm = convertMonth(row[12]); // Convert month number
                const policyno = row[15];

                const entry = resultsMap.get(monthName);
                entry.sum += dedamt;
                entry.details.push({ dedcode, policyno, effyy, effmm, termyy, termmm, dedamt });
            }
        });
    });

    resultsMap.forEach((data, monthName) => {
        const row = document.createElement('tr');
        row.innerHTML = `
        <!--     <td>${monthName}</td> -->
            <td id="totalAmount">
                â‚±${data.sum.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}
                <button id="viewmore" class="btn btn-link" style="color: white; padding-left: 10px;" onclick="toggleDetails(this)">View More</button>
            </td>
        `;
        tbody.appendChild(row);
        
        const detailRow = document.createElement('tr');
        detailRow.classList.add('details-row', 'hidden'); // Initially hidden
        const detailCell = document.createElement('td');
        detailCell.setAttribute('colspan', 2);
        detailCell.innerHTML = `
            <table class="table table-sm text-white" style="font-size:11px">
                <thead>
                    <tr>
                        <th>/</th>
                        <th>PLI</th>
                        <th>EFFECTIVE</th>
                        <th>TERMINATE</th>
                        <th>DEDAMT</th>
                        <th>POLICYNO</th>
                    </tr>
                </thead>
                <tbody>
                    ${data.details.map(d => `
                        <tr>
                            <td><input type="checkbox" class="dedamt-checkbox" data-dedamt="${d.dedamt}" checked /></td>
                            <td>${d.dedcode.toString().padStart(5, '0')}</td>
                            <td>${d.effmm.toString().padStart(2, '0')}/${d.effyy}</td>
                            <td>${d.termmm.toString().padStart(2, '0')}/${d.termyy}</td>
                            <td><b>â‚±${d.dedamt.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</b></td>
                            <td>${d.policyno}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
        
        detailRow.appendChild(detailCell);
        tbody.appendChild(detailRow);
    });

    table.appendChild(tbody);
    resultsSectionOnq.appendChild(table);
}

function toggleDetails(button) {
    const detailsRow = button.closest('tr').nextElementSibling; // Find the next row (details)
    detailsRow.classList.toggle('hidden'); // Toggle visibility
}



function updateresultsonq() {
    // Get the total amount from the totalAmount cell
    const totalAmountCell = document.getElementById('totalAmount');
    const totalAmountText = totalAmountCell.textContent || ""; // Fallback in case of no content
    const totalAmountNumber = parseFloat(totalAmountText.replace(/[â‚±,]/g, '').trim()); // Remove currency and commas

    // Update the resultsonq with the total amount
    const resultsonq = document.getElementsByClassName('resultsonq');
    resultsonq.textContent = `â‚±${totalAmountNumber.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
}

// Call this function whenever the total amount is updated
// Example usage after you set the total amount somewhere in your code
// updateresultsonq();








// Initial CSS to hide details rows
const style = document.createElement('style');
style.textContent = `
    .hidden {
        display: none;
    }
`;
document.head.appendChild(style);




function convertMonth(monthNumber) {
    const monthNames = ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"];
    return monthNames[parseInt(monthNumber, 10) - 1];
}
function calculateTotal() {
    const checkboxes = document.querySelectorAll('.dedamt-checkbox');
    let total = 0;

    checkboxes.forEach(checkbox => {
        if (checkbox.checked) {
            total += parseFloat(checkbox.dataset.dedamt);
        }
    });

    const totalDisplay = document.querySelector('#totalAmount');
    totalDisplay.innerText = `â‚±${total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;

    // Create or update the View More button
    let viewMoreButton = document.querySelector('#viewmore');
    if (!viewMoreButton) {
        // Create the button if it doesn't exist
        viewMoreButton = document.createElement('button');
        viewMoreButton.setAttribute('id', 'viewmore');
        viewMoreButton.classList.add('btn', 'btn-link');
        viewMoreButton.style.color = 'white';
        viewMoreButton.style.paddingLeft = '10px';
        viewMoreButton.innerText = 'View More';
        viewMoreButton.onclick = function () { toggleDetails(this); };

        // Append the button to the totalDisplay element
        totalDisplay.appendChild(viewMoreButton);
    }
}


// Event listener for checkbox changes
document.addEventListener('change', (event) => {
    if (event.target.classList.contains('dedamt-checkbox')) {
        calculateTotal();
    }
});

// Initial calculation on page load
document.addEventListener('DOMContentLoaded', calculateTotal);










    




    























































    document.addEventListener('DOMContentLoaded', () => {
        const prompt = document.getElementById('fullscreenPrompt');

        // Show the prompt when the mouse moves
        document.addEventListener('mousemove', () => {
            prompt.style.display = 'block';
        });

        // Enter fullscreen when the prompt is clicked
        prompt.addEventListener('click', () => {
            openFullscreen();
            prompt.style.display = 'none'; // Hide prompt after entering full-screen
        });
    });

    function openFullscreen() {
        const elem = document.documentElement;
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        } else if (elem.mozRequestFullScreen) {
            elem.mozRequestFullScreen();
        } else if (elem.webkitRequestFullscreen) {
            elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen();
        }
    }




const csvFilesPLI = [
    'pli_aug24.csv'
];

document.getElementById('searchButtonPLI').addEventListener('click', searchEmployeePLI);









function searchEmployeePLI() {
    const searchInputPLI = document.getElementById('searchInputPLI').value.trim();
    const loadingIndicatorPLI = document.getElementById('loadingIndicatorPLI');

    if (!searchInputPLI) {
        alert('Please enter an employee number.');
        return;
    }

    const resultsSectionPLI1 = document.getElementById('resultsPLI1');
    const resultsSectionPLI2 = document.getElementById('resultsPLI2');
    const resultsSectionPLI3 = document.getElementById('resultsPLI3');
    const resultsSectionPLI4 = document.getElementById('resultsPLI4');
    const resultsSectionPLI5 = document.getElementById('resultsPLI5');
    
    
    const employeeInfoSectionPLI = document.getElementById('employeeInfoPLI');


    resultsSectionPLI1.innerHTML = ''; // Clear previous results





    employeeInfoSectionPLI.innerHTML = ''; // Clear previous employee info
    loadingIndicatorPLI.style.display = 'block'; // Show loading indicator

    const last12MonthsFilesPLI = csvFilesPLI.slice(0, 12);

    let fetchedDataPLI = [];

    Promise.all(last12MonthsFilesPLI.map(csvFile => fetchCSVPLI(csvFile)))
        .then(allData => {
            fetchedDataPLI = allData.filter(data => data !== null);
            if (fetchedDataPLI.length === 0) {
                alert('No valid data found in the provided files.');
                return;
            }
            fetchedDataPLI.sort((a, b) => b.date - a.date);
            displayEmployeeInfoPLI(fetchedDataPLI[0].monthName, fetchedDataPLI[0].csvData);
            displayResultsTablePLI(fetchedDataPLI);
        })
        .catch(error => {
            console.error('Error fetching CSV data:', error);
            alert('Error fetching data. Check the console for more details.');
        })
        .finally(() => {
            loadingIndicatorPLI.style.display = 'none'; // Hide loading indicator
        });
}

function fetchCSVPLI(csvFile) {
    return new Promise((resolve, reject) => {
        const monthName = getMonthNameFromCsvPLI(csvFile);
        const date = getDateFromCsvPLI(csvFile);

        fetch(csvFile)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Unable to fetch ${csvFile}. Status: ${response.status}`);
                }
                return response.text();
            })
            .then(text => {
                const csvData = parseCSVPLI(text);
                resolve({ monthName, csvData, date });
            })
            .catch(error => {
                console.error(`Error fetching data for ${monthName}:`, error);
                resolve(null);
            });
    });
}

function getDateFromCsvPLI(csvFile) {
    const fileName = csvFile.replace('pli_', '');
    const monthMap = {
        'jan': 0, 'feb': 1, 'mar': 2, 'apr': 3, 'may': 4, 'jun': 5,
        'jul': 6, 'aug': 7, 'sep': 8, 'oct': 9, 'nov': 10, 'dec': 11
    };
    const monthPart = fileName.slice(0, 3);
    const yearPart = '20' + fileName.slice(3, 5);
    const monthIndex = monthMap[monthPart];
    return new Date(yearPart, monthIndex);
}

function getMonthNameFromCsvPLI(csvFile) {
    const fileName = csvFile.replace('pli_', '');
    const monthMap = {
        'jan': 'January', 'feb': 'February', 'mar': 'March', 'apr': 'April', 'may': 'May', 'jun': 'June',
        'jul': 'July', 'aug': 'August', 'sep': 'September', 'oct': 'October', 'nov': 'November', 'dec': 'December'
    };
    const monthPart = fileName.slice(0, 3);
    const yearPart = '20' + fileName.slice(3, 5);
    return `${monthMap[monthPart]} ${yearPart}`;
}

function parseCSVPLI(data) {
    const rows = data.trim().split('\n');
    return rows.map(row => row.split(','));
}

function displayEmployeeInfoPLI(monthName, csvData) {
    const employeeInfoSectionPLI = document.getElementById('employeeInfoPLI');
    let employeeFound = false;

    for (let i = 1; i < csvData.length; i++) {
        const row = csvData[i];
        if (row.length < 4) continue;
        const empno = row[3];
        if (empno === document.getElementById('searchInputPLI').value.trim()) {
            employeeFound = true;

            const div = row[1];
            const sta = row[2];
            const fname = row[5];
            const mi = row[6];
            const lname = row[7];

            employeeInfoSectionPLI.innerHTML = `

            `;
            break;
        }
    }

    if (!employeeFound) {
        employeeInfoSectionPLI.innerHTML = 'No employee found in the latest data.';
    }
}












function displayResultsTablePLI(fetchedDataPLI) {
    const resultsSections = [
        document.getElementById('resultsPLI1'),
        document.getElementById('resultsPLI2'),
        document.getElementById('resultsPLI3'),
        document.getElementById('resultsPLI4'),
        document.getElementById('resultsPLI5'),
    ];

    resultsSections.forEach((resultsSection, index) => {
        // Create a new table for each results section
        const table = createResultsTable(fetchedDataPLI, index);
        resultsSection.appendChild(table);
    });
}

function createResultsTable(fetchedDataPLI, tableIndex) {
    const table = document.createElement('table');
    table.classList.add('table', 'table-borderless', 'text-white');

    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = `<!-- <th class="font-weight-bold">PLI MONTH</th>
        <th class="font-weight-bold">Total Amount</th> -->`;
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement('tbody');
    const resultsMap = new Map();

    fetchedDataPLI.forEach(data => {
        data.csvData.forEach((row, index) => {
            if (index === 0) return;

            const empno = row[3];
            if (empno === document.getElementById('searchInputPLI').value.trim()) {
                const monthName = data.monthName;
                const dedamtpli = parseFloat(row[15]);

                if (!resultsMap.has(monthName)) {
                    resultsMap.set(monthName, { sum: 0, details: [] });
                }

                const dedcode = row[9];
                const effyy = row[11];
                const effmm = convertMonth(row[12]);
                const termyy = row[13];
                const termmm = convertMonth(row[14]);
                const policyno = row[16];

                const entry = resultsMap.get(monthName);
                entry.sum += dedamtpli;
                entry.details.push({ dedcode, policyno, effyy, effmm, termyy, termmm, dedamtpli });
            }
        });
    });

    resultsMap.forEach((data, monthName) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <!-- <td>${monthName}</td> -->
            <td id="totalAmountPLI${tableIndex}">
               <!-- â‚±${data.sum.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} -->
                
                â‚±0.00
                <button class="view-more-btn" style="margin-left: 10px;">Select PLI</button>
            </td>
        `;
        tbody.appendChild(row);

        const detailRow = document.createElement('tr');
        const detailCell = document.createElement('td');
        detailCell.setAttribute('colspan', 2);
        detailCell.innerHTML = `
            <table class="table table-sm text-white" style="font-size:11px">
                <thead>
                    <tr>
                        <th>/</th>
                        <th>PLI</th>
                        <th>EFFECTIVE</th>
                        <th>TERMINATE</th>
                        <th>DEDAMTPLI</th>
                        <th>POLICYNO</th>
                    </tr>
                </thead>
                <tbody>
                    ${data.details.map(d => `
                        <tr>
                            <td><input type="checkbox" class="dedamtpli-checkbox" data-dedamtpli="${d.dedamtpli}" /></td>
                            <td>${d.dedcode.toString().padStart(5, '0')}</td>
                            <td>${d.effmm.toString().padStart(2, '0')}/${d.effyy}</td>
                            <td>${d.termmm.toString().padStart(2, '0')}/${d.termyy}</td>
                            <td><b>â‚±${d.dedamtpli.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</b></td>
                            <td>${d.policyno}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;

        detailRow.style.display = 'none';

        row.querySelector('.view-more-btn').addEventListener('click', () => {
            const isVisible = detailRow.style.display === 'table-row';
            detailRow.style.display = isVisible ? 'none' : 'table-row';
        });

        detailRow.appendChild(detailCell);
        tbody.appendChild(detailRow);
    });

    table.appendChild(tbody);
    
    // Handle checkbox logic
    const handleCheckboxClick = (event) => {
        // Deselect all other checkboxes in this specific table
        let totalAmount = 0;

        // Loop through all checkboxes in this table's context
        table.querySelectorAll('.dedamtpli-checkbox').forEach(checkbox => {
            if (checkbox === event.target) {
                // If the current checkbox is checked, add to total
                if (checkbox.checked) {
                    totalAmount = parseFloat(checkbox.getAttribute('data-dedamtpli'));
                }
            } else {
                // Uncheck all other checkboxes
                checkbox.checked = false;
            }
        });

        // Update the total amount displayed in the table
        const totalAmountPLICell = document.querySelector(`#totalAmountPLI${tableIndex}`);
        totalAmountPLICell.innerHTML = `â‚±${totalAmount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;

        // Clear previous "View More" button if exists
        const existingButton = totalAmountPLICell.querySelector('.view-more-btn');
        if (existingButton) {
            existingButton.remove();
        }

        // Create and append new "View More" button
        const viewMoreButton = document.createElement('button');
        viewMoreButton.textContent = "Select PLI";
        viewMoreButton.classList.add('view-more-btn');
        viewMoreButton.style.marginLeft = '10px';

        viewMoreButton.addEventListener('click', (event) => {
            const detailRow = event.target.closest('tr').nextElementSibling;
            const isVisible = detailRow.style.display === 'table-row';
            detailRow.style.display = isVisible ? 'none' : 'table-row';
        });

        totalAmountPLICell.appendChild(viewMoreButton);
    };

    // Add event listeners to checkboxes for this table
    table.querySelectorAll('.dedamtpli-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', handleCheckboxClick);
    });

    return table;
}










































function checkFinalTotalValue() {
    const finalTotalElement = document.getElementById('finalTotalValue');
    const value = parseFloat(finalTotalElement.textContent.replace(/[^0-9.-]+/g,"")); // Remove any non-numeric characters

    if (value < 5000) {
        finalTotalElement.style.color = 'red';
    } else {
        finalTotalElement.style.color = ''; // Reset to default if not below 5000
    }
}

// Call the function whenever needed (e.g., after value update)
checkFinalTotalValue();



</SCRIPT>







































<script>
    function syncInputs(value) {
        document.getElementById('searchInputPos').value = value;
        document.getElementById('searchInputOnq').value = value;
        document.getElementById('searchInputPLI').value = value;
    }

    function checkLoadingComplete(loadingIndicatorId) {
        return new Promise(resolve => {
            const loadingIndicator = document.getElementById(loadingIndicatorId);
            const checkLoading = setInterval(() => {
                if (loadingIndicator.style.display === 'none') {
                    clearInterval(checkLoading);
                    resolve();
                }
            }, 100); // Adjust the interval as needed
        });
    }

    async function triggerSearch(buttonId, loadingIndicatorId) {
        const button = document.getElementById(buttonId);
        button.disabled = true; // Disable the button to prevent multiple clicks
        button.click(); // Simulate the button click

        // Wait for the loading to complete
        await checkLoadingComplete(loadingIndicatorId);
        button.disabled = false; // Re-enable the button
    }

    function triggerAllButtonsOnce() {
        // Trigger all the buttons
        // document.getElementById('searchButtonNetpay').click();
        document.getElementById('searchButtonPos').click();
        document.getElementById('searchButtonOnq').click();
        document.getElementById('searchButtonPLI').click();

        // Disable all buttons after the first click to prevent future clicks
        document.getElementById('searchButtonNetpay').disabled = true;
        document.getElementById('searchButtonPos').disabled = true;
        document.getElementById('searchButtonOnq').disabled = true;
        document.getElementById('searchButtonPLI').disabled = true;
    }

    // Add event listeners to all buttons
    document.getElementById('searchButtonNetpay').addEventListener('click', triggerAllButtonsOnce);
    document.getElementById('searchButtonPos').addEventListener('click', triggerAllButtonsOnce);
    document.getElementById('searchButtonOnq').addEventListener('click', triggerAllButtonsOnce);
    document.getElementById('searchButtonPLI').addEventListener('click', triggerAllButtonsOnce);


</script>












































<div class="col-md-12 offset-md-1"> <!-- Added offset-md-1 to create space -->
    <div class="calculator bg-dark text-light border border-light p-4 rounded shadow-lg">
        <h2 class="text-center">Loan Payment Calculator</h2>

        <!-- Loan Amount -->
        <div class="mb-3">
            <label for="loanAmount" class="form-label">Loan Amount (Php)</label>
            <input type="text" class="form-control bg-dark text-light border-light" id="loanAmount" value="50,000" onblur="formatLoanAmount()" />
        </div>

        <!-- Rate -->
        <div class="mb-3">
            <label for="rate" class="form-label">Interest Rate (%)</label>
            <input type="text" class="form-control bg-dark text-light border-light" id="rate" value="9.66" readonly />
        </div>

        <!-- Terms Dropdown -->
        <div class="mb-3">
            <label for="terms" class="form-label">Terms (months)</label>
            <select id="terms" class="form-select bg-dark text-light border-light form-control" onchange="updateInterestRate()">
                <script>
                    for (let i = 6; i <= 60; i++) {
                        document.write('<option value="' + i + '"' + (i === 24 ? ' selected' : '') + '>' + i + '</option>');
                    }
                </script>
            </select>
        </div>

        <!-- Calculate Button -->
        <button class="btn btn-light w-100" id="calculatorinclude" onclick="calculatePayment()">Calculate Payment</button>

        <!-- Result Display -->
        <div class="result text-center mt-4">
            Monthly Payment: Php <span id="monthlyPayment">0.00</span>
        </div>
    </div>
</div>


















<script>
// Function to add thousand separators to loan amount
function formatLoanAmount() {
let input = document.getElementById("loanAmount");
let value = input.value.replace(/,/g, ''); // Remove commas for calculation
let formattedValue = parseFloat(value).toLocaleString('en', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
input.value = formattedValue;
}

// Update interest rate based on terms
function updateInterestRate() {
    let terms = parseInt(document.getElementById("terms").value);
    let rateInput = document.getElementById("rate");

    if (terms >= 6 && terms <= 12) {
        rateInput.value = "7.50";
    } else if (terms >= 13 && terms <= 24) {
        rateInput.value = "9.00";
    } else {
        rateInput.value = "9.66";
    }
}

// Calculate payment using the PMT formula// Calculate payment using the PMT formula
function calculatePayment() {
    let loanAmount = parseFloat(document.getElementById("loanAmount").value.replace(/,/g, '')); // Remove commas
    let rate = parseFloat(document.getElementById("rate").value);
    let terms = parseInt(document.getElementById("terms").value);

    // Convert rate to a monthly interest rate
    let monthlyRate = rate / 100 / 12;

    // Excel PMT formula equivalent in JavaScript
    let monthlyPayment = -loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, terms)) / (Math.pow(1 + monthlyRate, terms) - 1);

    // Ensure payment is always positive
    monthlyPayment = Math.abs(monthlyPayment);
    monthlyPayment = Math.ceil(monthlyPayment * 100) / 100;

    // Format the payment as PHP currency
    const formattedPayment = `â‚±${monthlyPayment.toLocaleString('en', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

    // Display the result in the monthlyPayment cell
    document.getElementById("monthlyPayment").textContent = formattedPayment;

    // Update the monthlyPaymentCell with the formatted payment
    const monthlyPaymentCell = document.getElementById("monthlyPaymentCell");
    monthlyPaymentCell.textContent = formattedPayment; // Update the cell with the payment value
}

</script>
















</body>

</html>

